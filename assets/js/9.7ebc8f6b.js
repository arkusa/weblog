(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{402:function(v,_,o){"use strict";o.r(_);var e=o(42),s=Object(e.a)({},(function(){var v=this,_=v.$createElement,o=v._self._c||_;return o("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[o("h1",{attrs:{id:"cross-domain"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#cross-domain"}},[v._v("#")]),v._v(" Cross Domain")]),v._v(" "),o("p",[v._v("受"),o("strong",[v._v("同源策略")]),v._v("限制, 对于我们不能在主站下访问外站的资源")]),v._v(" "),o("blockquote",[o("p",[v._v('当然 对于 <img src="" /> <link href="" /> 除外')])]),v._v(" "),o("p",[v._v("但是, 有时我们需要打破这种限制...")]),v._v(" "),o("h2",{attrs:{id:"跨域的方式"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#跨域的方式"}},[v._v("#")]),v._v(" 跨域的方式")]),v._v(" "),o("p",[v._v("跨域主要有以下几种方式, 他们分别适用于不同的应用场景")]),v._v(" "),o("h3",{attrs:{id:"cookie追踪"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#cookie追踪"}},[v._v("#")]),v._v(" cookie追踪")]),v._v(" "),o("ul",[o("li",[o("code",[v._v("jsonp")])])]),v._v(" "),o("p",[v._v("我发现基本所有面试都会问到"),o("code",[v._v("jsonp")]),v._v(", 但是很少人会问你"),o("code",[v._v("jsonp")]),v._v("的应用场景")]),v._v(" "),o("p",[v._v("在我看来"),o("code",[v._v("jsonp")]),v._v("这种"),o("code",[v._v("hack 手段")]),v._v(", 想较于"),o("code",[v._v("server 代理")]),v._v("实在是过于鸡肋了, "),o("code",[v._v("server 代理")]),v._v("可以代替"),o("code",[v._v("jsonp")]),v._v("的所有应用场景, 这让我纠结了很久")]),v._v(" "),o("p",[v._v("直到不久前, 我在探究"),o("strong",[v._v("Cookie")]),v._v("性质的时候, 我发现了它独一无二的应用场景 "),o("code",[v._v("Cookie 追踪")])]),v._v(" "),o("hr"),v._v(" "),o("p",[v._v("它利用到了浏览器自动发送同源"),o("strong",[v._v("Cookie")]),v._v("特性")]),v._v(" "),o("p",[v._v("🌰")]),v._v(" "),o("ol",[o("li",[v._v("你在A站搜索商品")]),v._v(" "),o("li",[v._v("A 站将你 🔍 的内容通过"),o("code",[v._v("GET")]),v._v("请求发送到C 站")]),v._v(" "),o("li",[v._v("此时 C 站将你浏览的商品 又种到了 C 域名的Cookie下")]),v._v(" "),o("li",[v._v("当用户访问 B 站的时候, B站内嵌了一个请求 C 站的接口("),o("code",[v._v("https://www.c.com/parse/cookie")]),v._v(")")]),v._v(" "),o("li",[v._v("这个接口讲 C 域名下的 "),o("strong",[v._v("Cookie")]),v._v(" 解析, 然后通过 "),o("code",[v._v("jsonp")]),v._v("的方式传递给B站")]),v._v(" "),o("li",[v._v("此时B 站 就能拿到 C站域名下的"),o("strong",[v._v("Cookie")]),v._v(", 当然这个"),o("strong",[v._v("Cookie")]),v._v("内存放了你在 A 站🔍 的内容")])]),v._v(" "),o("p",[v._v("通过这种方式, 就可以做到设备 维度的用户追踪(不需要额外的库, 也不需要额外的关联信息user_id...)")]),v._v(" "),o("p",[v._v("因为浏览器是不允许我们访问/操作其他域名下的"),o("strong",[v._v("Cookie")]),v._v(", 通过这种方式我们就能间接访问/操作三方域名下的"),o("strong",[v._v("Cookie")])]),v._v(" "),o("p",[v._v("除了"),o("code",[v._v("jsonp")]),v._v(", 我没想到任何其他方式能够访问/操作其他域名下的"),o("strong",[v._v("Cookie")]),v._v(", 当然这里指的是三方"),o("strong",[v._v("Cookie")]),v._v(", 不包括父/子域名下的"),o("strong",[v._v("Cookie")])]),v._v(" "),o("p",[o("code",[v._v("jsonp")]),v._v("再也不像个憨憨了")]),v._v(" "),o("hr"),v._v(" "),o("h3",{attrs:{id:"共享本地数据"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#共享本地数据"}},[v._v("#")]),v._v(" 共享本地数据")]),v._v(" "),o("ul",[o("li",[o("code",[v._v("iframe + (window.name / window.location.hash / postMessage)")])])]),v._v(" "),o("p",[v._v("共享数据一般都是为了实现用户在不同父/子域名下的免密登陆")]),v._v(" "),o("ol",[o("li",[v._v("将父站 通过"),o("code",[v._v("iframe")]),v._v("嵌入到页面, 且隐藏")]),v._v(" "),o("li",[v._v("登陆的时候, 我们将用户信息 存放到父域名的"),o("code",[v._v("localStorage")]),v._v("中")]),v._v(" "),o("li",[v._v("切换其他子站的时候, 如果子站也嵌入了父站的"),o("code",[v._v("iframe")]),v._v("就能够拿到上次存放的用户信息")]),v._v(" "),o("li",[v._v("校验是否过期, 登陆")])]),v._v(" "),o("h3",{attrs:{id:"跨域api"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#跨域api"}},[v._v("#")]),v._v(" 跨域API")]),v._v(" "),o("ul",[o("li",[o("code",[v._v("server 代理")])])]),v._v(" "),o("p",[v._v("一般都是通过"),o("code",[v._v("nginx")]),v._v("转发")]),v._v(" "),o("p",[v._v("当然你也可以适用任意后端语言实现自己的同源接口, 然后调用外站"),o("code",[v._v("API")])]),v._v(" "),o("hr"),v._v(" "),o("p",[v._v("其中对用户隐藏的"),o("code",[v._v("server")]),v._v("叫做 "),o("strong",[v._v("反向代理")])]),v._v(" "),o("p",[v._v("比如: "),o("code",[v._v("nginx")])]),v._v(" "),o("p",[v._v("对用户可见的方式叫做 "),o("strong",[v._v("正向代理")])]),v._v(" "),o("p",[v._v("比如: "),o("code",[v._v("vpn")])]),v._v(" "),o("h3",{attrs:{id:"标准化的跨域"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#标准化的跨域"}},[v._v("#")]),v._v(" 标准化的跨域")]),v._v(" "),o("ul",[o("li",[o("code",[v._v("cors")])])]),v._v(" "),o("p",[v._v("值得一提的是"),o("code",[v._v("cors")]),v._v("除了发生在"),o("code",[v._v("xhr | fetch")]),v._v("外, 也发生在加载图片资源上")]),v._v(" "),o("hr"),v._v(" "),o("p",[v._v("图片的跨域一般发生在将"),o("code",[v._v("img")]),v._v("绘制到"),o("code",[v._v("canvas")]),v._v("上, 并且导出"),o("code",[v._v("base64")])]),v._v(" "),o("h3",{attrs:{id:"websocket协议"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#websocket协议"}},[v._v("#")]),v._v(" WebSocket协议")]),v._v(" "),o("p",[v._v("浏览器同源策略的限制是作用在"),o("strong",[v._v("HTTP协议")]),v._v("上的, 我们可以是用"),o("strong",[v._v("WebSocket")]),v._v("来代替"),o("code",[v._v("xhr | fetch")])]),v._v(" "),o("p",[v._v("关于"),o("strong",[v._v("WebSocket")]),v._v(" 了解不够深入, 不清楚其优劣点, 比如会不会因为保持通话链接造成额外的服务端负载")]),v._v(" "),o("p",[v._v("TODO")]),v._v(" "),o("h2",{attrs:{id:"链接"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#链接"}},[v._v("#")]),v._v(" 链接")]),v._v(" "),o("p",[v._v("关于跨域方式的具体内容，可以参考")]),v._v(" "),o("ul",[o("li",[o("a",{attrs:{href:""}},[v._v("jsonp")])]),v._v(" "),o("li",[o("a",{attrs:{href:""}},[v._v("iframe + (location.hash / window.name / postMessage)")])]),v._v(" "),o("li",[o("a",{attrs:{href:""}},[v._v("cors")])])])])}),[],!1,null,null,null);_.default=s.exports}}]);