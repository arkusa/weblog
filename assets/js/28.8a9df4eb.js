(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{392:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[t._v("#")]),t._v(" COOKIE")]),t._v(" "),a("h2",{attrs:{id:"cookie解决了什么问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie解决了什么问题"}},[t._v("#")]),t._v(" Cookie解决了什么问题")]),t._v(" "),a("p",[t._v("我们知道"),a("strong",[t._v("HTTP")]),t._v("协议是"),a("strong",[t._v("无状态")]),t._v("的")]),t._v(" "),a("p",[a("strong",[t._v("Cookie")]),t._v("是为了解决某些场景(由于"),a("strong",[t._v("无状态")]),t._v("特性, 导致不能满足需求)而诞生")]),t._v(" "),a("p",[t._v("比如: "),a("strong",[t._v("免密登陆")])]),t._v(" "),a("h3",{attrs:{id:"什么是无状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是无状态"}},[t._v("#")]),t._v(" 什么是无状态?")]),t._v(" "),a("p",[t._v("举个🌰")]),t._v(" "),a("p",[a("strong",[t._v("ClientA")]),t._v("向"),a("strong",[t._v("Server")]),t._v("发送了2个"),a("strong",[t._v("HTTP")]),t._v("请求, "),a("strong",[t._v("Server")]),t._v("只能收到2个请求, 但却不知道这2个请求来自于"),a("strong",[t._v("ClientA")]),t._v(". 这就是"),a("strong",[t._v("无状态")]),t._v("的含义")]),t._v(" "),a("p",[t._v("比如打开同一个网址, 任何人获得的结果都是一样的, 没有状态的区分")]),t._v(" "),a("h3",{attrs:{id:"为什么http被设计为无状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么http被设计为无状态"}},[t._v("#")]),t._v(" 为什么HTTP被设计为无状态?")]),t._v(" "),a("p",[t._v("这么设计的目的在于缓解"),a("strong",[t._v("server")]),t._v("压力")]),t._v(" "),a("p",[t._v("由于"),a("code",[t._v("web")]),t._v("请求具有突发性, 如果要让"),a("strong",[t._v("HTTP")]),t._v("协议是有状态的, 那就要让"),a("strong",[t._v("clinet")]),t._v("和"),a("strong",[t._v("server")]),t._v("保持会话状态. 就像打电话一样, 如果多个人同时给你打📱, 那一定会有人处于忙线状态")]),t._v(" "),a("p",[a("strong",[t._v("server")]),t._v("也是一样")]),t._v(" "),a("p",[t._v("为了处理高并发, "),a("strong",[t._v("HTTP")]),t._v("协议被设计为"),a("strong",[t._v("无状态")])]),t._v(" "),a("h3",{attrs:{id:"cookie的诞生"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie的诞生"}},[t._v("#")]),t._v(" Cookie的诞生")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("web")]),t._v("初期还好, 但是随着"),a("code",[t._v("web")]),t._v("的高速发展, 越来越多的场景需要"),a("strong",[t._v("server")]),t._v("知道请求发送方的状态")]),t._v(" "),a("p",[t._v("比如: "),a("strong",[t._v("用户的登陆态")])]),t._v(" "),a("p",[t._v("实现这种"),a("strong",[t._v("case")]),t._v("不一定要依赖于协议维度的扩展. 在系统维度, 也满足实现条件")]),t._v(" "),a("p",[t._v("e.g.")]),t._v(" "),a("p",[t._v("可以在登陆接口下发一些"),a("code",[t._v("userId")]),t._v("等的信息, 然后在后续接口中都将这些信息传给"),a("strong",[t._v("server")]),t._v(", 这样就在系统维度让"),a("code",[t._v("web")]),t._v("变得有状态")]),t._v(" "),a("p",[t._v("但是这种方案有一个不可忽视的问题, 下发下来的信息只在当前会话中能获取到, 缺少"),a("strong",[t._v("本地存储")]),t._v(", 每次用户访问页面都需要登陆, 不能做到"),a("strong",[t._v("登陆态的持久化")]),t._v("("),a("code",[t._v("web storage")]),t._v("是"),a("code",[t._v("h5")]),t._v("提出的概念)")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("为了彻底解决这类"),a("strong",[t._v("case")]),t._v(", "),a("strong",[t._v("HTTP")]),t._v("协议扩展了"),a("strong",[t._v("Cookie")]),t._v("这一概念")]),t._v(" "),a("p",[a("strong",[t._v("Cookie")]),t._v("被设计为, 可以由"),a("strong",[t._v("server")]),t._v("通过"),a("strong",[t._v("headers")]),t._v("直接设置, 在"),a("strong",[t._v("client")]),t._v("持久化存储, 并随着"),a("strong",[t._v("HTTP请求")]),t._v("自动发送")]),t._v(" "),a("p",[t._v("你有没有想过为什么不直接设计一个本地存储的API呢?("),a("code",[t._v("storage")]),t._v(")")]),t._v(" "),a("p",[t._v("这是一个设计上的问题")]),t._v(" "),a("p",[a("strong",[t._v("Cookie")]),t._v("是"),a("strong",[t._v("HTTP")]),t._v("协议的补充, 没有"),a("strong",[t._v("Cookie")]),t._v(", "),a("strong",[t._v("HTTP")]),t._v("协议就不能覆盖到需要状态持久化的"),a("strong",[t._v("case")])]),t._v(" "),a("p",[a("strong",[t._v("storage")]),t._v("是可以解决"),a("strong",[t._v("HTTP")]),t._v("状态持久化的手段. 但他能解决的问题远远超过了"),a("strong",[t._v("状态持久化")]),t._v(", 未免杀鸡用牛刀, 而且使用"),a("strong",[t._v("storage")]),t._v("我们需要还需要手动在某些接口将信息存入"),a("strong",[t._v("storage")]),t._v(", 在某些接口取出"),a("strong",[t._v("storage")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("小程序, 快应用都不支持"),a("code",[t._v("cookie")]),t._v(", 只能通过"),a("code",[t._v("storage")]),t._v("做用户状态的持久化")]),t._v(" "),a("p",[t._v("快应用还没有同步获得"),a("code",[t._v("storage")]),t._v("的API, 如果不引入"),a("code",[t._v("async/awiat")]),t._v("的polyfill, 就会陷入深深的"),a("code",[t._v("callback hell")])])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("同时"),a("strong",[t._v("Cookie")]),t._v("的设计还有以下优势")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("可以由服务端配置")])])]),t._v(" "),a("p",[t._v("服务端配置"),a("code",[t._v("set-cookie")]),t._v("header, 浏览器根据"),a("code",[t._v("set-cookie")]),t._v("的值直接存储在本地, 不需要脚本参与存储")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("自动发送")])])]),t._v(" "),a("p",[t._v("在发送请求时, 会将当前域下的"),a("strong",[t._v("Cookie")]),t._v("一并发送, 不需要脚本参与发送")]),t._v(" "),a("p",[a("strong",[t._v("Cookie")]),t._v("是浏览器和"),a("strong",[t._v("server")]),t._v("间的约定, 不用前端脚本变更, 就可以满足"),a("strong",[t._v("HTTP")]),t._v("有状态")]),t._v(" "),a("p",[a("strong",[t._v("Storage")]),t._v("需要浏览器, "),a("strong",[t._v("server")]),t._v("和"),a("strong",[t._v("javaScript")]),t._v("共同作用, 才可以满足"),a("strong",[t._v("HTTP")]),t._v("有状态")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("当然这种设计也导致了隐私的泄漏")]),t._v(" "),a("p",[t._v("你是否遇到过这类的场景: 你在某站搜索了一些商品. 在访问其他站的时候, 有时这类商品就处于推荐位上.")]),t._v(" "),a("p",[t._v("这可不仅仅是巧合, 而是基于"),a("strong",[t._v("Cookie")]),t._v("追踪了用户行为")]),t._v(" "),a("h2",{attrs:{id:"cookie的特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie的特性"}},[t._v("#")]),t._v(" Cookie的特性")]),t._v(" "),a("p",[t._v("像上面提到的"),a("strong",[t._v("Cookie")]),t._v("具有如下特性")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("本地持久化(4kb)")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("可以由服务端配置, 浏览器自动生效")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("伴随当前域名的HTTP请求自动发送")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("受同源策略保护")])]),t._v(" "),a("p",[t._v("只能当前域名下的请求和脚本才能获得当前域名的"),a("strong",[t._v("Cookie")])])])]),t._v(" "),a("h2",{attrs:{id:"cookie的属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie的属性"}},[t._v("#")]),t._v(" Cookie的属性")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Expires/Max-Age")])])]),t._v(" "),a("p",[t._v("设置"),a("strong",[t._v("Cookie")]),t._v("的有效期, 默认是"),a("code",[t._v("Session")]),t._v(". 当浏览器彻底关闭(进程被杀死), 这个"),a("strong",[t._v("Cookie")]),t._v("就从该域名下被删除")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("关闭当前tab页, 关闭当前窗口, 都不会将"),a("code",[t._v("Session")]),t._v("状态的"),a("strong",[t._v("Cookie")]),t._v("删除, 除非彻底杀死Chrome进程")])]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("Expires")]),t._v("的值是"),a("code",[t._v("UTC 世界标准时间")]),t._v("格式的时间点")]),t._v(" "),a("p",[t._v("我国使用的是"),a("strong",[t._v("东八区")]),t._v("时间, 比"),a("strong",[t._v("UTC 世界标准时间")]),t._v("提前了8个小时")]),t._v(" "),a("p",[t._v("直接使用"),a("code",[t._v("new Date().toString()")]),t._v("得到的时间是中国标准时间("),a("strong",[t._v("东八区时间")]),t._v(")")]),t._v(" "),a("p",[t._v("如果我们直接")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("cookie_expires=expires; Expires=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("这个"),a("strong",[t._v("Cookie")]),t._v("将会在8个小时后过期")]),t._v(" "),a("p",[t._v("所以我们应该使用"),a("code",[t._v("new Date().toUTCString()")])]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("cookie_expires=expires; Expires=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toUTCString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这相当于没设置Cookie, 因为设置了一个错误时间点的Cookie, 当前时间的UTC格式，已经过去了")]),t._v("\n\nres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("cookie_expires=expires; Expires=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toUTCString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一天后过期")]),t._v("\n\nres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("cookie_expires=expires; Expires=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 32小时后过期")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("在服务端设置Cookie实际上是用服务端的的时间和客户端的时间对比, 存在误差")])]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("Max-Age")]),t._v("的值是一段时间, 以"),a("code",[t._v("s")]),t._v("为单位, "),a("code",[t._v("cookie_max-age=max-age; Max-Age=10")]),t._v("意思是"),a("code",[t._v("cookie_max-age")]),t._v("将在10秒后过期, 与"),a("code",[t._v("Expires")]),t._v("相比, 其只用客户端时间做比较, 没有误差")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cookie_max-age=max-age; Max-Age=10'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("code",[t._v("Max-Age")]),t._v("也可以是一个负值")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("给已经存在的"),a("strong",[t._v("Cookie")])]),t._v(" "),a("p",[t._v("设置负的"),a("code",[t._v("Max-Age")]),t._v("相当于删除这个"),a("strong",[t._v("Cookie")])]),t._v(" "),a("p",[t._v("设置过期(客户端根据本地时间判断是不是过期)的"),a("code",[t._v("Expires")]),t._v("相当于设置了"),a("code",[t._v("Session")]),t._v("状态的"),a("strong",[t._v("Cookie")]),t._v("(这里我只测试了chrome)")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("给不存在的"),a("strong",[t._v("Cookie")])]),t._v(" "),a("p",[t._v("设置负的"),a("code",[t._v("Max-Age")]),t._v("和过期的"),a("code",[t._v("Expires")]),t._v("都相当于没有设置这个"),a("strong",[t._v("Cookie")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("如果你想删除某个"),a("strong",[t._v("Cookie")]),t._v(", 请使用"),a("code",[t._v("Max-Age")])])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Domain")])])]),t._v(" "),a("p",[a("strong",[t._v("Domain")]),t._v("表明了当前"),a("strong",[t._v("Cookie")]),t._v("被存放到那个域名下, 默认是当前域名"),a("code",[t._v("window.location.host")])]),t._v(" "),a("p",[t._v("他的值不能随便设置，只能是以下2种")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("当前域名")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("当前域名的一级域名")])])])]),t._v(" "),a("p",[t._v("如果是"),a("strong",[t._v("当前域名")]),t._v(" 则只能在当前域下被发送, 如果是"),a("strong",[t._v("当前域名的一级域名")]),t._v("则在其子域下也会发送这个"),a("strong",[t._v("Cookie")])]),t._v(" "),a("p",[t._v("🌰")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set-cookie'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cookie_domain=domain; Domain=a.cookie.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只在a.cookie.com下的请求会发送这个cookie")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set-cookie'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cookie_domain=domain; Domain=.(可省略)cookie.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在a.cookie.com, b.cookie.com, c.cookie.com下都会发送这个cookie")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[a("strong",[t._v("当前域名的一级域名")]),t._v("一般应用在父/子域名间用户登陆共享. 在"),a("code",[t._v("a.cookie.com")]),t._v("下登陆, 在"),a("code",[t._v("b.cookie.com")]),t._v("下就不需要额外登陆了")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Path")])])]),t._v(" "),a("p",[a("strong",[t._v("Domain")]),t._v("表示的是"),a("strong",[t._v("Cookie")]),t._v("的存放域名, "),a("strong",[t._v("Path")]),t._v("则表示"),a("strong",[t._v("Cookie")]),t._v("的存放路径, 默认是"),a("strong",[t._v("当前网页的路径")])]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// https://a.cookie.com/weblog/net/http/cookie.html")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/cookie/get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set-cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cookie_path=path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此时Cookie的Path为 /weblog/net/http")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[a("strong",[t._v("Path")]),t._v("的匹配规则不是完全匹配, 即不是这样的"),a("code",[t._v("/^Path$/")]),t._v(", 而是"),a("code",[t._v("/^Path/")])]),t._v(" "),a("p",[t._v("🌰")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前主站a.cookie.com")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set-cookie'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cookie_path=path; Path=/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前域名下的所有路径都能获得这个cookie")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set-cookie'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cookie_path1=path1; Path=/path1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.cookie.com/path1 下的所有路径(包括自己)都能获得这个cookie a.cookie.com/path1/1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 但是a.cookie.com/path2 则不能获得这个cookie")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("HttpOnly")])])]),t._v(" "),a("p",[t._v("后面会提到通过"),a("code",[t._v("javaScript")]),t._v("脚本我们也能读取到"),a("strong",[t._v("Cookie")]),t._v(", 如果遭受到"),a("code",[t._v("XSS")]),t._v("攻击, 我们的"),a("strong",[t._v("Cookie")]),t._v("就可能会泄漏")]),t._v(" "),a("p",[a("strong",[t._v("HttpOnly")]),t._v("可以让当前"),a("strong",[t._v("Cookie")]),t._v("不能通过脚本获得到, 只能通过"),a("strong",[t._v("HTTP")]),t._v("请求发送")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set-cookie'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cookie_httpOnly=httpOnly; HttpOnly'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("Secure")])])]),t._v(" "),a("p",[a("strong",[t._v("Secure")]),t._v("让当前"),a("strong",[t._v("Cookie")]),t._v("只能通过"),a("strong",[t._v("HTTPS")]),t._v("协议被发送")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set-cookie'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cookie_secure=secure; Secure'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("SameSite")])])]),t._v(" "),a("p",[t._v("这个属性来源于"),a("strong",[t._v("Chrome")]),t._v(", 因为"),a("strong",[t._v("Chrome")]),t._v("正处于全面禁用第三方"),a("strong",[t._v("Cookie")]),t._v("的过渡阶段")]),t._v(" "),a("p",[t._v("我们前面提到的"),a("strong",[t._v("针对于Cookie的用户追踪")]),t._v(", 其大概逻辑是将用户行为存储到第三方域名的"),a("strong",[t._v("Cookie")]),t._v("下, 然后在其他站点, 获得这个"),a("strong",[t._v("第三方域名下的Cookie")]),t._v(", 就得到了用户的行为")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("- 注意")]),t._v(" "),a("p",[t._v("我们知道"),a("strong",[t._v("Cookie")]),t._v("受同源策略保护, 那要如何存/取第三方域名下的"),a("strong",[t._v("Cookie")]),t._v("呢?")]),t._v(" "),a("p",[t._v("前面我们也提到过, "),a("strong",[t._v("Cookie")]),t._v("可以由服务端设置")]),t._v(" "),a("p",[t._v("这意味着")]),t._v(" "),a("p",[t._v("如果我们在"),a("code",[t._v("a.cookie.com")]),t._v("下，请求了"),a("code",[t._v("b.cors.com")]),t._v("下的某个资源/接口, 并且这个接口配置了相应的"),a("strong",[t._v("Cookie")]),t._v(", 那么这个"),a("strong",[t._v("Cookie")]),t._v("就会被种到"),a("code",[t._v("b.cors.com")]),t._v("下, 即使我们没有访问过"),a("code",[t._v("b.cors.com")])]),t._v(" "),a("p",[t._v("基于此, 我们可以在点击商品(a.cookie.com下)的时候像b.cors.com的某个接口发送请求的时候带上这个商品的hash, 然后这个接口又将这个hash设置到"),a("code",[t._v("set-cookie")]),t._v("上, 这样这个hash就被存放到"),a("code",[t._v("b.cors.com")]),t._v("的"),a("strong",[t._v("Cookie")]),t._v("上了")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.cookie.com")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clickProduct")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("productCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hash "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("md5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("productCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://b.cors.com/user/product?product='")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" hash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// b.cors.com/user/product")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handlerProduct")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("hash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set-cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("__product_hash=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("hash"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[t._v("那如何取呢?")]),t._v(" "),a("p",[t._v("前面我们也提过"),a("strong",[t._v("Cookie")]),t._v("会随着HTTP自动发送")]),t._v(" "),a("p",[t._v("所以我们可以在"),a("code",[t._v("c.co.com")]),t._v("下跨域访问"),a("code",[t._v("b.cors.com/user/product/parse")]),t._v(", 又"),a("strong",[t._v("server")]),t._v("帮我们解析出"),a("strong",[t._v("Cookie")])]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// c.co.com")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jsonpCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里处理第三方的cookie")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserProduct")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("https://b.cors.com/user/product/parse?jsonp=jsonpCallback")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// b.cors.com/user/product/parse")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseProduct")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" cookie "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" reg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/(?<=jsonp=)[^&]+/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("jsonp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("math")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ret "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n    ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("jsonp"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("cookie"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(")\n  ")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/javascript'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br")])]),a("p",[t._v("这样我们就打破了"),a("strong",[t._v("Cookie")]),t._v("的同源策略, 可以进行"),a("strong",[t._v("Cookie")]),t._v("追踪")])]),t._v(" "),a("p",[t._v("这是由于这种泄漏隐私的"),a("strong",[t._v("case")]),t._v(", "),a("strong",[t._v("firefox")]),t._v(", "),a("strong",[t._v("safari")]),t._v("已经禁用了第三方的"),a("strong",[t._v("Cookie")])]),t._v(" "),a("p",[t._v("即在当前域名下，只能设置和上传当前域名的"),a("strong",[t._v("Cookie")]),t._v(", 即使你在文档中请求了第三方资源, 浏览器也不会为你上传和存储第三方的"),a("strong",[t._v("Cookie")])]),t._v(" "),a("p",[a("strong",[t._v("Chrome")]),t._v("于2019年宣布将在2年内完全禁用"),a("strong",[t._v("第三方Cookie")])]),t._v(" "),a("p",[t._v("在这期间可以使用"),a("strong",[t._v("SameSite")]),t._v("属性, 由网站配置是否禁用"),a("strong",[t._v("第三方Cookie")])]),t._v(" "),a("p",[t._v("它有3个值")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("None")])])]),t._v(" "),a("p",[t._v("和正常一样, 可以自由设置"),a("strong",[t._v("Cookie")]),t._v(", 需要注意其必须和"),a("strong",[t._v("Secure")]),t._v("一起使用, 否则无效")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("strong",[t._v("Lax")]),t._v("(默认)")])]),t._v(" "),a("p",[a("strong",[t._v("Chrome")]),t._v("将默认值由"),a("strong",[t._v("None")]),t._v("更新为"),a("strong",[t._v("Lax")])]),t._v(" "),a("p",[t._v("其只在某些时候发送/设置第三方Cookie, "),a("code",[t._v('<a href="" />')]),t._v("跳转, "),a("code",[t._v('<link ref="preload" >')]),t._v("预加载和"),a("code",[t._v("get")]),t._v("表单(要注意这里不是get请求)")]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("strong",[t._v("Strict")])])]),t._v(" "),a("p",[t._v("不发送/设置"),a("strong",[t._v("第三方Cookie")])]),t._v(" "),a("p",[t._v("所以如果现在需要做"),a("strong",[t._v("Cookie追踪")]),t._v(", 我们针对在"),a("strong",[t._v("Chrome")]),t._v("并且设置"),a("code",[t._v("SameSite=None; Secure")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("__Secure- 和 __Host- 前缀")])])]),t._v(" "),a("p",[t._v("如果你的"),a("strong",[t._v("Cookie")]),t._v("值是"),a("code",[t._v("__Secure-")]),t._v("或者"),a("code",[t._v("__Host-")]),t._v(", 那么当前"),a("strong",[t._v("Cookie")]),t._v("必须具有某些属性")]),t._v(" "),a("p",[a("code",[t._v("__Secure-")]),t._v(": 这个"),a("strong",[t._v("Cookie")]),t._v("必须配置"),a("code",[t._v("Secure")])]),t._v(" "),a("p",[a("code",[t._v("__Host-")]),t._v(": 这个"),a("strong",[t._v("Cookie")]),t._v("必须配置"),a("code",[t._v("Secure")]),t._v(", 并且"),a("strong",[t._v("Domain")]),t._v("必须为"),a("code",[t._v("window.location.host")]),t._v(", "),a("strong",[t._v("Path")]),t._v("必须为"),a("code",[t._v("/")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("同时"),a("strong",[t._v("SameSite")]),t._v("还能够预防"),a("strong",[t._v("CSRF")]),t._v("攻击")]),t._v(" "),a("p",[t._v("我们知道"),a("strong",[t._v("CSRF")]),t._v("就是在第三方网站上通过冒用用户"),a("strong",[t._v("Cookie")]),t._v("🐓 的, 如果目标网站的关键"),a("strong",[t._v("Cookie")]),t._v("的"),a("strong",[t._v("SameSite=!None")]),t._v(", 那么这些"),a("strong",[t._v("Cookie")]),t._v("就不会在攻击者的第三方网站上被发送, 从根本上杜绝了"),a("strong",[t._v("CSRF")]),t._v("🐓")]),t._v(" "),a("h2",{attrs:{id:"如何设置cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何设置cookie"}},[t._v("#")]),t._v(" 如何设置Cookie")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("前端")])])]),t._v(" "),a("p",[t._v("在前端可以通过脚本读取/设置"),a("strong",[t._v("Cookie")]),t._v(", "),a("code",[t._v("document.cookie")])]),t._v(" "),a("p",[a("code",[t._v("document.cookie")]),t._v("是一个属性存取器("),a("code",[t._v("getter setter")]),t._v("), 而不是一个属性")]),t._v(" "),a("p",[t._v("我们可以使用"),a("code",[t._v("Object.definePrototype")]),t._v("更改它")]),t._v(" "),a("p",[t._v("作为"),a("strong",[t._v("getter")]),t._v("时, 其能够获得当前域名下的所有"),a("strong",[t._v("Cookie")]),t._v("(不包括属性), 并且以"),a("code",[t._v("<key>=<value>")]),t._v("的形式以"),a("code",[t._v(";")]),t._v("连接到一起")]),t._v(" "),a("p",[t._v("作为"),a("strong",[t._v("setter")]),t._v("时, 其能够设置当前域名下的"),a("strong",[t._v("Cookie")]),t._v(", 但是不能配置"),a("strong",[t._v("HttpOnly")]),t._v(", 只有在"),a("strong",[t._v("https")]),t._v("协议下, 才能够配置"),a("strong",[t._v("Secure")])]),t._v(" "),a("p",[t._v("🌰")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.cookie.com")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a=1; HttpOnly'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无效")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b=1;'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无效")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c=1; Domain=cookie.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无效")]),t._v("\n\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'b=1; c=1'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("ul",[a("li",[a("strong",[t._v("服务端")])])]),t._v(" "),a("p",[a("strong",[t._v("server")]),t._v("只需要将"),a("strong",[t._v("Cookie")]),t._v("设置到响应头的"),a("code",[t._v("headers.Set-Cookie")]),t._v("上就好了")]),t._v(" "),a("p",[t._v("如果要获取发送来的"),a("strong",[t._v("Cookie")]),t._v("也从请求头中获得就好了")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" cookie "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a=1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("- 注意")]),t._v(" "),a("p",[t._v("同一个位置同名的"),a("strong",[t._v("Cookie")]),t._v("会发生覆盖")]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.cookie.com")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a=1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a=2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'a=2'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("需要注意"),a("strong",[t._v("同一个位置")]),t._v(", 如果我们将同名的"),a("strong",[t._v("Cookie")]),t._v("存放到了不同的Path下，那么我们就会的到2个同名的"),a("strong",[t._v("Cookie")])]),t._v(" "),a("div",{staticClass:"language-javaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.cookie.com/path")]),t._v("\n\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path=1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path=2; Path=/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'path=1; path=2'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])]),t._v(" "),a("h2",{attrs:{id:"cookie危害"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie危害"}},[t._v("#")]),t._v(" Cookie危害")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("CSRF 🐓")])])]),t._v(" "),a("p",[t._v("关于"),a("strong",[t._v("CSRF")]),t._v("的内容请看这里"),a("RouterLink",{attrs:{to:"/safety/web/csrf.html"}},[t._v("CSRF")])],1),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Cookie用户追踪")])])]),t._v(" "),a("p",[t._v("前面提到过"),a("strong",[t._v("Cookie")]),t._v("可能被用来追踪用户行为")]),t._v(" "),a("h2",{attrs:{id:"其他cookie问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他cookie问题"}},[t._v("#")]),t._v(" 其他Cookie问题")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("流量损失")])])]),t._v(" "),a("p",[t._v("我们知道"),a("strong",[t._v("Cookie")]),t._v("是自动随着域名下的请求发送的, 这就可能造成损失，可能我们并不需要"),a("strong",[t._v("Cookie")]),t._v(", 但是其自动发送给"),a("strong",[t._v("server")]),t._v("了")]),t._v(" "),a("p",[t._v("比如: 静态资源...")]),t._v(" "),a("p",[t._v("所以对图片等静态资源, 我们一般将其放到专门的域名("),a("strong",[t._v("这里指的是域名, 不是机器哦")]),t._v(")下, 不过一般企业都会建立专门的静态资源服务器")])])}),[],!1,null,null,null);s.default=e.exports}}]);