<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小明的故事 | askura</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="askura's weblog">
    <link rel="preload" href="/weblog/assets/css/0.styles.bd84e9de.css" as="style"><link rel="preload" href="/weblog/assets/js/app.73afb69f.js" as="script"><link rel="preload" href="/weblog/assets/js/2.b1d48028.js" as="script"><link rel="preload" href="/weblog/assets/js/30.cf77db1b.js" as="script"><link rel="prefetch" href="/weblog/assets/js/10.5e5257d2.js"><link rel="prefetch" href="/weblog/assets/js/11.ac268403.js"><link rel="prefetch" href="/weblog/assets/js/12.1aa44b2f.js"><link rel="prefetch" href="/weblog/assets/js/13.d254d810.js"><link rel="prefetch" href="/weblog/assets/js/14.99e6dc6d.js"><link rel="prefetch" href="/weblog/assets/js/15.b4307193.js"><link rel="prefetch" href="/weblog/assets/js/16.889db329.js"><link rel="prefetch" href="/weblog/assets/js/17.f907b394.js"><link rel="prefetch" href="/weblog/assets/js/18.eea8f088.js"><link rel="prefetch" href="/weblog/assets/js/19.84c994ab.js"><link rel="prefetch" href="/weblog/assets/js/20.91a0790a.js"><link rel="prefetch" href="/weblog/assets/js/21.f225089f.js"><link rel="prefetch" href="/weblog/assets/js/22.4271b9d7.js"><link rel="prefetch" href="/weblog/assets/js/23.29f5f4b4.js"><link rel="prefetch" href="/weblog/assets/js/24.12b1d527.js"><link rel="prefetch" href="/weblog/assets/js/25.e84d37ad.js"><link rel="prefetch" href="/weblog/assets/js/26.b50519d9.js"><link rel="prefetch" href="/weblog/assets/js/27.15235234.js"><link rel="prefetch" href="/weblog/assets/js/28.8a9df4eb.js"><link rel="prefetch" href="/weblog/assets/js/29.9b595a2b.js"><link rel="prefetch" href="/weblog/assets/js/3.94d94b8f.js"><link rel="prefetch" href="/weblog/assets/js/31.27e718fb.js"><link rel="prefetch" href="/weblog/assets/js/32.a51ac16d.js"><link rel="prefetch" href="/weblog/assets/js/33.e2fb7862.js"><link rel="prefetch" href="/weblog/assets/js/34.4f32cadf.js"><link rel="prefetch" href="/weblog/assets/js/4.a24ff65c.js"><link rel="prefetch" href="/weblog/assets/js/5.a6ef23be.js"><link rel="prefetch" href="/weblog/assets/js/6.c64d5164.js"><link rel="prefetch" href="/weblog/assets/js/7.05e16fa0.js"><link rel="prefetch" href="/weblog/assets/js/8.f29158ab.js"><link rel="prefetch" href="/weblog/assets/js/9.7ebc8f6b.js">
    <link rel="stylesheet" href="/weblog/assets/css/0.styles.bd84e9de.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/weblog/" class="home-link router-link-active"><!----> <span class="site-name">askura</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          HTTP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/net/http/cookie.html" class="nav-link">
  COOKIE
</a></li></ul></li><li class="dropdown-item"><h4>
          web安全
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/safety/web/csrf.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  CSRF
</a></li><li class="dropdown-subitem"><a href="/weblog/safety/web/xss.html" class="nav-link">
  XSS
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GIT" class="dropdown-title"><span class="title">GIT</span> <span class="arrow down"></span></button> <button type="button" aria-label="GIT" class="mobile-dropdown-title"><span class="title">GIT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          远程仓库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/git/remotes/clone.html" class="nav-link">
  clone
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/fetch.html" class="nav-link">
  fetch
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/pull.html" class="nav-link">
  pull
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/push.html" class="nav-link">
  push
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/git/branch.html" class="nav-link">
  branch
</a></li><li class="dropdown-item"><!----> <a href="/weblog/git/checkout.html" class="nav-link">
  checkout
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><span class="title">CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="CSS" class="mobile-dropdown-title"><span class="title">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Layout
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/css/layout/holy_grail.html" class="nav-link">
  圣杯布局揭秘
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/css/contain_block.html" class="nav-link">
  包含块(position定位)
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/stacking_context.html" class="nav-link">
  Stacking Context
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/box_model.html" class="nav-link">
  Box Model
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="VIM" class="dropdown-title"><span class="title">VIM</span> <span class="arrow down"></span></button> <button type="button" aria-label="VIM" class="mobile-dropdown-title"><span class="title">VIM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          插件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/vim/plugins/airline.html" class="nav-link">
  airline
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TMUX" class="dropdown-title"><span class="title">TMUX</span> <span class="arrow down"></span></button> <button type="button" aria-label="TMUX" class="mobile-dropdown-title"><span class="title">TMUX</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/tmux/theme.html" class="nav-link">
  theme
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="REDUX" class="dropdown-title"><span class="title">REDUX</span> <span class="arrow down"></span></button> <button type="button" aria-label="REDUX" class="mobile-dropdown-title"><span class="title">REDUX</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/redux/struct.html" class="nav-link">
  我理解的redux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Browser" class="dropdown-title"><span class="title">Browser</span> <span class="arrow down"></span></button> <button type="button" aria-label="Browser" class="mobile-dropdown-title"><span class="title">Browser</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Net
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/browser/net/cross_domain.html" class="nav-link">
  Cross Domain
</a></li><li class="dropdown-subitem"><a href="/weblog/browser/net/jsonp.html" class="nav-link">
  JSONP
</a></li><li class="dropdown-subitem"><a href="/weblog/browser/net/iframe_cross.html" class="nav-link">
  IFrame Cross
</a></li></ul></li><li class="dropdown-item"><h4>
          Render
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/browser/render/parse_document.html" class="nav-link">
  Parse Document
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/browser/processing_model.html" class="nav-link">
  Processing Model
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/javascript/ES6/Promise/api.html" class="nav-link">
  Promise API
</a></li><li class="dropdown-subitem"><a href="/weblog/javascript/ES6/Promise/polyfill.html" class="nav-link">
  Promise Polyfill
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/regExp.html" class="nav-link">
  RegExp
</a></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/function.html" class="nav-link">
  函数
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程化" class="dropdown-title"><span class="title">前端工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工程化" class="mobile-dropdown-title"><span class="title">前端工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/engineering/tree_shaking.html" class="nav-link">
  Tree Shaking
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计模式" class="dropdown-title"><span class="title">设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="设计模式" class="mobile-dropdown-title"><span class="title">设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          OOP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/design_pattern/oop/decorator.html" class="nav-link">
  Decorator Pattern
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="一些有意思的东西" class="dropdown-title"><span class="title">一些有意思的东西</span> <span class="arrow down"></span></button> <button type="button" aria-label="一些有意思的东西" class="mobile-dropdown-title"><span class="title">一些有意思的东西</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/interesting/git_credential.html" class="nav-link">
  讨厌的credential.helper=osxkeychain
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/vue/preface.html" class="nav-link">
  对Vue的认知
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Threejs" class="dropdown-title"><span class="title">Threejs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Threejs" class="mobile-dropdown-title"><span class="title">Threejs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/threejs/struct.html" class="nav-link">
  初识webgl
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          HTTP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/net/http/cookie.html" class="nav-link">
  COOKIE
</a></li></ul></li><li class="dropdown-item"><h4>
          web安全
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/safety/web/csrf.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  CSRF
</a></li><li class="dropdown-subitem"><a href="/weblog/safety/web/xss.html" class="nav-link">
  XSS
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GIT" class="dropdown-title"><span class="title">GIT</span> <span class="arrow down"></span></button> <button type="button" aria-label="GIT" class="mobile-dropdown-title"><span class="title">GIT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          远程仓库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/git/remotes/clone.html" class="nav-link">
  clone
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/fetch.html" class="nav-link">
  fetch
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/pull.html" class="nav-link">
  pull
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/push.html" class="nav-link">
  push
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/git/branch.html" class="nav-link">
  branch
</a></li><li class="dropdown-item"><!----> <a href="/weblog/git/checkout.html" class="nav-link">
  checkout
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><span class="title">CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="CSS" class="mobile-dropdown-title"><span class="title">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Layout
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/css/layout/holy_grail.html" class="nav-link">
  圣杯布局揭秘
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/css/contain_block.html" class="nav-link">
  包含块(position定位)
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/stacking_context.html" class="nav-link">
  Stacking Context
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/box_model.html" class="nav-link">
  Box Model
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="VIM" class="dropdown-title"><span class="title">VIM</span> <span class="arrow down"></span></button> <button type="button" aria-label="VIM" class="mobile-dropdown-title"><span class="title">VIM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          插件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/vim/plugins/airline.html" class="nav-link">
  airline
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TMUX" class="dropdown-title"><span class="title">TMUX</span> <span class="arrow down"></span></button> <button type="button" aria-label="TMUX" class="mobile-dropdown-title"><span class="title">TMUX</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/tmux/theme.html" class="nav-link">
  theme
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="REDUX" class="dropdown-title"><span class="title">REDUX</span> <span class="arrow down"></span></button> <button type="button" aria-label="REDUX" class="mobile-dropdown-title"><span class="title">REDUX</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/redux/struct.html" class="nav-link">
  我理解的redux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Browser" class="dropdown-title"><span class="title">Browser</span> <span class="arrow down"></span></button> <button type="button" aria-label="Browser" class="mobile-dropdown-title"><span class="title">Browser</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Net
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/browser/net/cross_domain.html" class="nav-link">
  Cross Domain
</a></li><li class="dropdown-subitem"><a href="/weblog/browser/net/jsonp.html" class="nav-link">
  JSONP
</a></li><li class="dropdown-subitem"><a href="/weblog/browser/net/iframe_cross.html" class="nav-link">
  IFrame Cross
</a></li></ul></li><li class="dropdown-item"><h4>
          Render
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/browser/render/parse_document.html" class="nav-link">
  Parse Document
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/browser/processing_model.html" class="nav-link">
  Processing Model
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/javascript/ES6/Promise/api.html" class="nav-link">
  Promise API
</a></li><li class="dropdown-subitem"><a href="/weblog/javascript/ES6/Promise/polyfill.html" class="nav-link">
  Promise Polyfill
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/regExp.html" class="nav-link">
  RegExp
</a></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/function.html" class="nav-link">
  函数
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程化" class="dropdown-title"><span class="title">前端工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工程化" class="mobile-dropdown-title"><span class="title">前端工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/engineering/tree_shaking.html" class="nav-link">
  Tree Shaking
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计模式" class="dropdown-title"><span class="title">设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="设计模式" class="mobile-dropdown-title"><span class="title">设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          OOP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/design_pattern/oop/decorator.html" class="nav-link">
  Decorator Pattern
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="一些有意思的东西" class="dropdown-title"><span class="title">一些有意思的东西</span> <span class="arrow down"></span></button> <button type="button" aria-label="一些有意思的东西" class="mobile-dropdown-title"><span class="title">一些有意思的东西</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/interesting/git_credential.html" class="nav-link">
  讨厌的credential.helper=osxkeychain
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/vue/preface.html" class="nav-link">
  对Vue的认知
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Threejs" class="dropdown-title"><span class="title">Threejs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Threejs" class="mobile-dropdown-title"><span class="title">Threejs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/threejs/struct.html" class="nav-link">
  初识webgl
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>小明的故事</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/safety/web/csrf.html#小明的故事" class="sidebar-link">小明的故事</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/weblog/safety/web/csrf.html#csrf" class="sidebar-link">CSRF</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/weblog/safety/web/csrf.html#csrf的攻击思路" class="sidebar-link">CSRF的攻击思路</a></li><li class="sidebar-sub-header"><a href="/weblog/safety/web/csrf.html#csrf的特点" class="sidebar-link">CSRF的特点</a></li><li class="sidebar-sub-header"><a href="/weblog/safety/web/csrf.html#什么样的网站存在csrf风险" class="sidebar-link">什么样的网站存在CSRF风险</a></li><li class="sidebar-sub-header"><a href="/weblog/safety/web/csrf.html#csrf的防御" class="sidebar-link">CSRF的防御</a></li><li class="sidebar-sub-header"><a href="/weblog/safety/web/csrf.html#浏览器的csrf防御" class="sidebar-link">浏览器的CSRF防御</a></li></ul></li><li><a href="/weblog/safety/web/csrf.html#参考文章" class="sidebar-link">参考文章</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="小明的故事"><a href="#小明的故事" class="header-anchor">#</a> 小明的故事</h2> <p>某天小明正在浏览B站主站, 不经意间看到一条广告: <code>10元充年费大会员</code>, '这可是好事情呀', 小明这么想着就点了进去. 结果只看到了一个空白页面... 日常吐槽后, 小明继续随便逛着.</p> <p>第二天, 小明在B站直播看到一个可爱的萌妹子, 就想上船支持一下🌹, 然后小明就发现自己背包内的'金瓜子'不翼而飞了...</p> <p>可怜的妹子. 😏</p> <hr> <p>tips: 上面的内容纯属杜撰, 小破站这么优秀是不会有问题的</p> <hr> <p><strong>小明的金瓜子是如何消失的呢?</strong></p> <p>问题发生在小明打开的空白页面上(<code>10元充年费大会员</code>), 攻击者小黑通过流量劫持将这个页面注入到小明访问的主站上, 在这个空白页面上向主播小红送了礼物</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">request</span><span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>xx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>com<span class="token operator">/</span>send<span class="token operator">/</span>gift<span class="token operator">/</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://xx.xxx.com/send/gift<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因为小明的用户信息在登陆主站的时候被种到了<code>cookie</code>中, 而<code>cookie</code>会随着http自动发送, 所以上面的请求成功的发送到了服务端, 服务端经过验证确定是小明在向小红送礼物, 正确效应, 就这样小明的金瓜子就消失掉了</p> <p>总结一下就是: 小黑冒充了小明给小红送了礼物</p> <h2 id="csrf"><a href="#csrf" class="header-anchor">#</a> CSRF</h2> <p>上面小明的故事就是一次<code>CSRF攻击</code></p> <blockquote><p>cross-site request forgery 跨站请求伪造, 是一种冒充用户发送请求的攻击方式</p></blockquote> <h3 id="csrf的攻击思路"><a href="#csrf的攻击思路" class="header-anchor">#</a> CSRF的攻击思路</h3> <ol><li>受害者访问页面A, 成功登陆, 并且用户凭证是保存在<code>cookie</code>中</li> <li>受害者受攻击者引导访问了攻击者准备好的页面B(A, B不同源)</li> <li>攻击者在页面B提交了页面A的某个请求(A.com/xxx), 由于<code>cookie</code>自动发送的关系, A的用户凭证被发送</li> <li>服务端验证A的用户凭证, 确认是A发送过来的请求(实际是B发送的), 正确响应</li> <li>攻击完成, A 😡</li></ol> <h3 id="csrf的特点"><a href="#csrf的特点" class="header-anchor">#</a> CSRF的特点</h3> <ul><li>请求发送自第三方网站</li></ul> <p>一般攻击都是来自第三方网站, 所以像简书, 知乎...论坛对于访问外链的url会进行风险提示</p> <ul><li>针对cookie攻击</li></ul> <p>利用cookie自动发送 且 在cookie中保存用户信息来达到对用户的冒充(这里只是冒充用户, 并不能得到cookie内容)</p> <p>如果某站将用户信息存储在<code>localStorage</code>中, 则其不会存在CSRF攻击的潜在风险, 这是因为受同源策略限制, 在第三方页面中(这里排除了父子域的情况)无法通过脚本得到主站的内容</p> <h3 id="什么样的网站存在csrf风险"><a href="#什么样的网站存在csrf风险" class="header-anchor">#</a> 什么样的网站存在CSRF风险</h3> <ul><li><p>使用<code>cookie</code>存储一些可以通过服务端请求的必要信息(用户信息...)</p></li> <li><p>具有父/子域名的网站(e.g. image.baidu.com, zhidao.baidu.com)</p></li></ul> <p>这是由<code>cookie</code>的应用场景决定的</p> <p>一般我们使用<code>cookie</code>来保持会话状态, 达到免密登陆的效果</p> <p>对于单一域名的网站, 使用<code>cookie</code>免密的好处只是在发送请求的时候少些一些代码而已. 将一些需要持久化的信息放到<code>localStorage</code>中, 同样可以做到免密登陆</p> <p>但是对于父/子域名的网站, 使用<code>cookie</code>是必要的, 由于同源策略的限制, <code>a.xx.com</code>和<code>b.xx.com</code>的<code>localStorage</code>不是通用的, 但是通过配置<code>cookie</code>的<code>domain=xx.com</code>, <code>a.xx.com</code>和<code>b.xx.com</code>会共用相同的<code>cookie</code></p> <p>这样使用<code>cookie</code>可以实现从<code>https://www.bilibili.com</code>跳转到<code>https://live.bilibili.com</code>下不需要继续登陆, 使用<code>localStorage</code>则不能</p> <hr> <p>tips: 父/子域名不使用<code>cookie</code>, 在技术上也是可以实现跳转免密的, 这需要使用一个另外的<code>c.xx.com</code>: 用来存储信息, 然后分别在<code>a.xx.com</code>和<code>b.xx.com</code>内嵌入这样<code>iframe</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c.xx.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="csrf的防御"><a href="#csrf的防御" class="header-anchor">#</a> CSRF的防御</h3> <p>根据<a href="#csrf%E7%9A%84%E7%89%B9%E7%82%B9">CSRF的特点</a>我们可以从以下3个方面对CSRF进行防御</p> <ul><li><p><strong>攻击发生自第三方网站, 接口要判断是否同源(在可发送请求的白名单内)</strong></p></li> <li><p><strong>请求附加额外的信息(这个额外的信息要在本站内通过脚本得到)</strong></p></li> <li><p><strong>不使用cookie</strong></p></li></ul> <h4 id="攻击发生自第三方网站-接口要判断是否同源-在可发送请求的白名单内"><a href="#攻击发生自第三方网站-接口要判断是否同源-在可发送请求的白名单内" class="header-anchor">#</a> 攻击发生自第三方网站, 接口要判断是否同源(在可发送请求的白名单内)</h4> <p>这种防御方式是根据用户代理(浏览器)在访问第三方链接会在<code>request headers</code>内添加一些额外字段</p> <ul><li><p>referer</p></li> <li><p>origin</p></li></ul> <p>用户代理在<code>&lt;a /&gt;</code>, <code>&lt;iframe /&gt;</code>, <code>&lt;img /&gt;</code>, <code>跨域xhr</code>...时, 如果源地址是不是当前主站的地址, 则会增加一个<code>referer: 主站地址</code></p> <p>对于<code>CORS</code>请求(<code>&lt;img /&gt;</code>, <code>跨域xhr</code>), 除了referer还会增加一个<code>origin: window.location.origin</code>, 用来做<code>CORS</code>验证</p> <p>将<strong>referer</strong>和<strong>origin</strong>作为判断是否是CSRF攻击的依据, 如果存在referer或origin 且 referer或origin不在白名单内则认为是攻击, 拒绝请求 ❌</p> <hr> <p>这种请求是否来自第三方网站的判断依赖于用户代理, 同时用户代理提供了<code>Referrer-Policy: &lt;value&gt;</code>来控制referer的表现行为</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>referrer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>no-referrer<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样用户代理就不会添加referer请求头字段, 可能你会说: '不是还有origin么, 这个字段不会消失, 对referer和origin做与逻辑不就好了'</p> <p>但是<strong>origin</strong>只会被添加在<code>跨域xhr</code>, <code>&lt;img /&gt;</code>中, 对于GET请求, 攻击者可以通过<code>&lt;a /&gt;</code>诱导点击和<code>&lt;script /&gt;</code>的方式</p> <p>这种情况下<strong>referer</strong>和<strong>origin</strong>都不存在, 会被认为是主站下的请求</p> <hr> <p>综上: 判断请求是不是发生自第三方网站来预防并不能过滤掉所有的CSRF攻击</p> <h4 id="附加额外的信息"><a href="#附加额外的信息" class="header-anchor">#</a> 附加额外的信息</h4> <ul><li><strong>Token</strong></li></ul> <p>在用户的登陆接口, 和验证是否登陆的接口, 服务端生成一个Hash并存储到Session中, 同时将这个Hash返回, 后续的请求发送需要将这个Hash一同发送给服务端(一般是负载在request headers内 token: hash, <strong>这个Token一定不能随着cookie发送</strong>), 这样服务端通过headrs的hash和Session中的hash进行验证,  就可以知道这个请求是否是在主站下发送的</p> <hr> <p>这是因为这个hash是通过脚本得到的, 受同源策略保护</p> <hr> <p>⚠️   : 上面提到的策略不适用于分布式系统, 一般企业都存在很多机房, 分布在不同的地方, 所以使用随机生成Hash的方式会造成不同机器Session内存储的Hash不一样...</p> <p><strong>所以, 在分布式系统中, 不使用随机生成Hash的策略, 而是通过用户的userId, 有效时间... 生成的计算值</strong>, 这样每次计较计算结果就可以验证请求是否来自第三方</p> <ul><li><strong>双重Cookie</strong></li></ul> <p><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html#%E5%8F%8C%E9%87%8Dcookie%E9%AA%8C%E8%AF%81" target="_blank" rel="noopener noreferrer">美团: CSRF<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>对于<strong>双重Cookie</strong>有一些情况我不是很理解</p> <ol><li>为什么要将额外的负载信息通过种Cookie的方式下发给页面</li></ol> <p>因为在访问页面的时候, 我们都会访问一个登陆接口, 为什么不在登陆接口返回</p> <p>按照我的理解<strong>双重Cookie</strong>只是相对于<strong>Token</strong>缺少一个鲜度校验的过程, 只比较负载信息是否正确, 而没有校验负载信息是否过期</p> <ul><li><strong>验证码</strong></li></ul> <p>对于一些特别敏感的操作使用验证码来避免CSRF, 比如支付</p> <h4 id="不使用cookie"><a href="#不使用cookie" class="header-anchor">#</a> 不使用Cookie</h4> <p>CSRF是针对cookie进行的攻击手段, 找到一种满足需求且不使用cookie的代替手段就好了, 比如上面提到的使用<code>localStorage</code>实现父/子域跳转免密</p> <h3 id="浏览器的csrf防御"><a href="#浏览器的csrf防御" class="header-anchor">#</a> 浏览器的CSRF防御</h3> <p>针对CSRF浏览器提供了<code>SameSite Cookie</code>来设置什么情况下可以发送第三方的cookie</p> <ul><li>None</li></ul> <p>发送第三方Cookie, 只在Secure下才可以使用</p> <ul><li>Lax (默认)</li></ul> <p>在某些情况下才可以发送第三方Cookie, 比如<code>&lt;a /&gt;</code></p> <ul><li>Strict</li></ul> <p>永远不发送第三方Cookie</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code>res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>
  <span class="token string">'Set-Cookie'</span><span class="token punctuation">,</span>
  <span class="token string">'userId=AxsEZmec; SameSite=Lax'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>
  <span class="token string">'Set-Cookie'</span><span class="token punctuation">,</span>
  <span class="token string">'userId=AxsEZmec; SameSite=None; Secure;'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <p><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener noreferrer">前端安全系列（二）：如何防止CSRF攻击？ - 美团技术团队<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/arkusa/askura/edit/master/docs/safety/web/csrf.md" target="_blank" rel="noopener noreferrer">编辑此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/11/2020, 9:02:25 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/weblog/assets/js/app.73afb69f.js" defer></script><script src="/weblog/assets/js/2.b1d48028.js" defer></script><script src="/weblog/assets/js/30.cf77db1b.js" defer></script>
  </body>
</html>
