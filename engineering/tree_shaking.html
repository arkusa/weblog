<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tree Shaking | askura</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="askura's weblog">
    <link rel="preload" href="/weblog/assets/css/0.styles.bd84e9de.css" as="style"><link rel="preload" href="/weblog/assets/js/app.73afb69f.js" as="script"><link rel="preload" href="/weblog/assets/js/2.b1d48028.js" as="script"><link rel="preload" href="/weblog/assets/js/16.889db329.js" as="script"><link rel="prefetch" href="/weblog/assets/js/10.5e5257d2.js"><link rel="prefetch" href="/weblog/assets/js/11.ac268403.js"><link rel="prefetch" href="/weblog/assets/js/12.1aa44b2f.js"><link rel="prefetch" href="/weblog/assets/js/13.d254d810.js"><link rel="prefetch" href="/weblog/assets/js/14.99e6dc6d.js"><link rel="prefetch" href="/weblog/assets/js/15.b4307193.js"><link rel="prefetch" href="/weblog/assets/js/17.f907b394.js"><link rel="prefetch" href="/weblog/assets/js/18.eea8f088.js"><link rel="prefetch" href="/weblog/assets/js/19.84c994ab.js"><link rel="prefetch" href="/weblog/assets/js/20.91a0790a.js"><link rel="prefetch" href="/weblog/assets/js/21.f225089f.js"><link rel="prefetch" href="/weblog/assets/js/22.4271b9d7.js"><link rel="prefetch" href="/weblog/assets/js/23.29f5f4b4.js"><link rel="prefetch" href="/weblog/assets/js/24.12b1d527.js"><link rel="prefetch" href="/weblog/assets/js/25.e84d37ad.js"><link rel="prefetch" href="/weblog/assets/js/26.b50519d9.js"><link rel="prefetch" href="/weblog/assets/js/27.15235234.js"><link rel="prefetch" href="/weblog/assets/js/28.8a9df4eb.js"><link rel="prefetch" href="/weblog/assets/js/29.9b595a2b.js"><link rel="prefetch" href="/weblog/assets/js/3.94d94b8f.js"><link rel="prefetch" href="/weblog/assets/js/30.cf77db1b.js"><link rel="prefetch" href="/weblog/assets/js/31.27e718fb.js"><link rel="prefetch" href="/weblog/assets/js/32.a51ac16d.js"><link rel="prefetch" href="/weblog/assets/js/33.e2fb7862.js"><link rel="prefetch" href="/weblog/assets/js/34.4f32cadf.js"><link rel="prefetch" href="/weblog/assets/js/4.a24ff65c.js"><link rel="prefetch" href="/weblog/assets/js/5.a6ef23be.js"><link rel="prefetch" href="/weblog/assets/js/6.c64d5164.js"><link rel="prefetch" href="/weblog/assets/js/7.05e16fa0.js"><link rel="prefetch" href="/weblog/assets/js/8.f29158ab.js"><link rel="prefetch" href="/weblog/assets/js/9.7ebc8f6b.js">
    <link rel="stylesheet" href="/weblog/assets/css/0.styles.bd84e9de.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/weblog/" class="home-link router-link-active"><!----> <span class="site-name">askura</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç½‘ç»œ" class="dropdown-title"><span class="title">ç½‘ç»œ</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç½‘ç»œ" class="mobile-dropdown-title"><span class="title">ç½‘ç»œ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          HTTP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/net/http/cookie.html" class="nav-link">
  COOKIE
</a></li></ul></li><li class="dropdown-item"><h4>
          webå®‰å…¨
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/safety/web/csrf.html" class="nav-link">
  CSRF
</a></li><li class="dropdown-subitem"><a href="/weblog/safety/web/xss.html" class="nav-link">
  XSS
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GIT" class="dropdown-title"><span class="title">GIT</span> <span class="arrow down"></span></button> <button type="button" aria-label="GIT" class="mobile-dropdown-title"><span class="title">GIT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          è¿œç¨‹ä»“åº“
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/git/remotes/clone.html" class="nav-link">
  clone
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/fetch.html" class="nav-link">
  fetch
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/pull.html" class="nav-link">
  pull
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/push.html" class="nav-link">
  push
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/git/branch.html" class="nav-link">
  branch
</a></li><li class="dropdown-item"><!----> <a href="/weblog/git/checkout.html" class="nav-link">
  checkout
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><span class="title">CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="CSS" class="mobile-dropdown-title"><span class="title">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Layout
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/css/layout/holy_grail.html" class="nav-link">
  åœ£æ¯å¸ƒå±€æ­ç§˜
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/css/contain_block.html" class="nav-link">
  åŒ…å«å—(positionå®šä½)
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/stacking_context.html" class="nav-link">
  Stacking Context
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/box_model.html" class="nav-link">
  Box Model
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="VIM" class="dropdown-title"><span class="title">VIM</span> <span class="arrow down"></span></button> <button type="button" aria-label="VIM" class="mobile-dropdown-title"><span class="title">VIM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          æ’ä»¶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/vim/plugins/airline.html" class="nav-link">
  airline
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TMUX" class="dropdown-title"><span class="title">TMUX</span> <span class="arrow down"></span></button> <button type="button" aria-label="TMUX" class="mobile-dropdown-title"><span class="title">TMUX</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/tmux/theme.html" class="nav-link">
  theme
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="REDUX" class="dropdown-title"><span class="title">REDUX</span> <span class="arrow down"></span></button> <button type="button" aria-label="REDUX" class="mobile-dropdown-title"><span class="title">REDUX</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/redux/struct.html" class="nav-link">
  æˆ‘ç†è§£çš„redux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Browser" class="dropdown-title"><span class="title">Browser</span> <span class="arrow down"></span></button> <button type="button" aria-label="Browser" class="mobile-dropdown-title"><span class="title">Browser</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Net
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/browser/net/cross_domain.html" class="nav-link">
  Cross Domain
</a></li><li class="dropdown-subitem"><a href="/weblog/browser/net/jsonp.html" class="nav-link">
  JSONP
</a></li><li class="dropdown-subitem"><a href="/weblog/browser/net/iframe_cross.html" class="nav-link">
  IFrame Cross
</a></li></ul></li><li class="dropdown-item"><h4>
          Render
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/browser/render/parse_document.html" class="nav-link">
  Parse Document
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/browser/processing_model.html" class="nav-link">
  Processing Model
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/javascript/ES6/Promise/api.html" class="nav-link">
  Promise API
</a></li><li class="dropdown-subitem"><a href="/weblog/javascript/ES6/Promise/polyfill.html" class="nav-link">
  Promise Polyfill
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/regExp.html" class="nav-link">
  RegExp
</a></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/function.html" class="nav-link">
  å‡½æ•°
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯å·¥ç¨‹åŒ–" class="dropdown-title"><span class="title">å‰ç«¯å·¥ç¨‹åŒ–</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯å·¥ç¨‹åŒ–" class="mobile-dropdown-title"><span class="title">å‰ç«¯å·¥ç¨‹åŒ–</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/engineering/tree_shaking.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Tree Shaking
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è®¾è®¡æ¨¡å¼" class="dropdown-title"><span class="title">è®¾è®¡æ¨¡å¼</span> <span class="arrow down"></span></button> <button type="button" aria-label="è®¾è®¡æ¨¡å¼" class="mobile-dropdown-title"><span class="title">è®¾è®¡æ¨¡å¼</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          OOP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/design_pattern/oop/decorator.html" class="nav-link">
  Decorator Pattern
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿" class="dropdown-title"><span class="title">ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿</span> <span class="arrow down"></span></button> <button type="button" aria-label="ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿" class="mobile-dropdown-title"><span class="title">ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/interesting/git_credential.html" class="nav-link">
  è®¨åŒçš„credential.helper=osxkeychain
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/vue/preface.html" class="nav-link">
  å¯¹Vueçš„è®¤çŸ¥
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Threejs" class="dropdown-title"><span class="title">Threejs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Threejs" class="mobile-dropdown-title"><span class="title">Threejs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/threejs/struct.html" class="nav-link">
  åˆè¯†webgl
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç½‘ç»œ" class="dropdown-title"><span class="title">ç½‘ç»œ</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç½‘ç»œ" class="mobile-dropdown-title"><span class="title">ç½‘ç»œ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          HTTP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/net/http/cookie.html" class="nav-link">
  COOKIE
</a></li></ul></li><li class="dropdown-item"><h4>
          webå®‰å…¨
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/safety/web/csrf.html" class="nav-link">
  CSRF
</a></li><li class="dropdown-subitem"><a href="/weblog/safety/web/xss.html" class="nav-link">
  XSS
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GIT" class="dropdown-title"><span class="title">GIT</span> <span class="arrow down"></span></button> <button type="button" aria-label="GIT" class="mobile-dropdown-title"><span class="title">GIT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          è¿œç¨‹ä»“åº“
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/git/remotes/clone.html" class="nav-link">
  clone
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/fetch.html" class="nav-link">
  fetch
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/pull.html" class="nav-link">
  pull
</a></li><li class="dropdown-subitem"><a href="/weblog/git/remotes/push.html" class="nav-link">
  push
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/git/branch.html" class="nav-link">
  branch
</a></li><li class="dropdown-item"><!----> <a href="/weblog/git/checkout.html" class="nav-link">
  checkout
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><span class="title">CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="CSS" class="mobile-dropdown-title"><span class="title">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Layout
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/css/layout/holy_grail.html" class="nav-link">
  åœ£æ¯å¸ƒå±€æ­ç§˜
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/css/contain_block.html" class="nav-link">
  åŒ…å«å—(positionå®šä½)
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/stacking_context.html" class="nav-link">
  Stacking Context
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/box_model.html" class="nav-link">
  Box Model
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="VIM" class="dropdown-title"><span class="title">VIM</span> <span class="arrow down"></span></button> <button type="button" aria-label="VIM" class="mobile-dropdown-title"><span class="title">VIM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          æ’ä»¶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/vim/plugins/airline.html" class="nav-link">
  airline
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TMUX" class="dropdown-title"><span class="title">TMUX</span> <span class="arrow down"></span></button> <button type="button" aria-label="TMUX" class="mobile-dropdown-title"><span class="title">TMUX</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/tmux/theme.html" class="nav-link">
  theme
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="REDUX" class="dropdown-title"><span class="title">REDUX</span> <span class="arrow down"></span></button> <button type="button" aria-label="REDUX" class="mobile-dropdown-title"><span class="title">REDUX</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/redux/struct.html" class="nav-link">
  æˆ‘ç†è§£çš„redux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Browser" class="dropdown-title"><span class="title">Browser</span> <span class="arrow down"></span></button> <button type="button" aria-label="Browser" class="mobile-dropdown-title"><span class="title">Browser</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Net
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/browser/net/cross_domain.html" class="nav-link">
  Cross Domain
</a></li><li class="dropdown-subitem"><a href="/weblog/browser/net/jsonp.html" class="nav-link">
  JSONP
</a></li><li class="dropdown-subitem"><a href="/weblog/browser/net/iframe_cross.html" class="nav-link">
  IFrame Cross
</a></li></ul></li><li class="dropdown-item"><h4>
          Render
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/browser/render/parse_document.html" class="nav-link">
  Parse Document
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/browser/processing_model.html" class="nav-link">
  Processing Model
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/javascript/ES6/Promise/api.html" class="nav-link">
  Promise API
</a></li><li class="dropdown-subitem"><a href="/weblog/javascript/ES6/Promise/polyfill.html" class="nav-link">
  Promise Polyfill
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/regExp.html" class="nav-link">
  RegExp
</a></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/function.html" class="nav-link">
  å‡½æ•°
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯å·¥ç¨‹åŒ–" class="dropdown-title"><span class="title">å‰ç«¯å·¥ç¨‹åŒ–</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯å·¥ç¨‹åŒ–" class="mobile-dropdown-title"><span class="title">å‰ç«¯å·¥ç¨‹åŒ–</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/engineering/tree_shaking.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Tree Shaking
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è®¾è®¡æ¨¡å¼" class="dropdown-title"><span class="title">è®¾è®¡æ¨¡å¼</span> <span class="arrow down"></span></button> <button type="button" aria-label="è®¾è®¡æ¨¡å¼" class="mobile-dropdown-title"><span class="title">è®¾è®¡æ¨¡å¼</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          OOP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/weblog/design_pattern/oop/decorator.html" class="nav-link">
  Decorator Pattern
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿" class="dropdown-title"><span class="title">ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿</span> <span class="arrow down"></span></button> <button type="button" aria-label="ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿" class="mobile-dropdown-title"><span class="title">ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/interesting/git_credential.html" class="nav-link">
  è®¨åŒçš„credential.helper=osxkeychain
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/vue/preface.html" class="nav-link">
  å¯¹Vueçš„è®¤çŸ¥
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Threejs" class="dropdown-title"><span class="title">Threejs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Threejs" class="mobile-dropdown-title"><span class="title">Threejs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/threejs/struct.html" class="nav-link">
  åˆè¯†webgl
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Tree Shaking</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/engineering/tree_shaking.html#tree-shaking-ä»¥åŠ-dce-çš„å…³ç³»" class="sidebar-link">Tree Shaking ä»¥åŠ DCE çš„å…³ç³»</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/weblog/engineering/tree_shaking.html#eslint-eslint-pacakge-å’Œ-eslint-vscode-æ’ä»¶-åœ¨-dce-æ–¹é¢çš„å±€é™" class="sidebar-link">ESLint(eslint pacakge å’Œ ESLint vscode æ’ä»¶)åœ¨ DCE æ–¹é¢çš„å±€é™</a></li><li class="sidebar-sub-header"><a href="/weblog/engineering/tree_shaking.html#ä»€ä¹ˆæ˜¯-tree-shaking" class="sidebar-link">ä»€ä¹ˆæ˜¯ Tree Shaking</a></li></ul></li><li><a href="/weblog/engineering/tree_shaking.html#webpack-æ˜¯å¦‚ä½•-tree-shaking" class="sidebar-link">Webpack æ˜¯å¦‚ä½• Tree Shaking</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/weblog/engineering/tree_shaking.html#webpack4-ä¹‹å‰ä»¤äººå°´å°¬çš„-tree-shaking" class="sidebar-link">Webpack4 ä¹‹å‰ä»¤äººå°´å°¬çš„ Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/weblog/engineering/tree_shaking.html#rollup-å’Œ-uglifyjs-çš„ä¸åŒ-dce-ç­–ç•¥" class="sidebar-link">rollup å’Œ uglifyjs çš„ä¸åŒ DCE ç­–ç•¥</a></li><li class="sidebar-sub-header"><a href="/weblog/engineering/tree_shaking.html#webpack4çš„tree-shaking" class="sidebar-link">Webpack4çš„Tree Shaking</a></li></ul></li><li><a href="/weblog/engineering/tree_shaking.html#ä¸€äº›å…¶ä»–æ³¨æ„ç‚¹" class="sidebar-link">ä¸€äº›å…¶ä»–æ³¨æ„ç‚¹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/weblog/engineering/tree_shaking.html#tree-shakingåªæœ‰ä½¿ç”¨es6æ¨¡å—åŒ–æ‰å¯ä»¥" class="sidebar-link">Tree Shakingåªæœ‰ä½¿ç”¨ES6æ¨¡å—åŒ–æ‰å¯ä»¥</a></li></ul></li><li><a href="/weblog/engineering/tree_shaking.html#ä¸ºäº†æ›´å¥½çš„tree-shakingæˆ‘ä»¬åº”è¯¥æ³¨æ„é‚£äº›äº‹æƒ…" class="sidebar-link">ä¸ºäº†æ›´å¥½çš„Tree Shakingæˆ‘ä»¬åº”è¯¥æ³¨æ„é‚£äº›äº‹æƒ…</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/weblog/engineering/tree_shaking.html#æ€»ç»“" class="sidebar-link">æ€»ç»“</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/weblog/engineering/tree_shaking.html#refs" class="sidebar-link">Refs</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h1> <p>æœ¬ç¯‡æ–‡ç« ä¸ä»‹ç»<code>rollup</code>ä»¥åŠ<code>uglifyjs</code>æ˜¯å¦‚ä½•<code>tree shaking</code>çš„, å¦‚æœä½ æƒ³äº†è§£çš„æ˜¯<code>AST</code>æ–¹é¢çš„å†…å®¹, èƒ½åŠ›ä¸å¤Ÿ çˆ±è«èƒ½åŠ©</p> <p>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»<code>webpack</code>æ˜¯å¦‚ä½•åˆ©ç”¨<code>uglifyjs</code>å®ç°<code>tree shaking</code>, åŠå…¶å±€é™æ€§, èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„åˆ†æå·¥ç¨‹, å»ºç«‹æœ€ä¼˜çš„æ„å»ºæµç¨‹</p> <h2 id="tree-shaking-ä»¥åŠ-dce-çš„å…³ç³»"><a href="#tree-shaking-ä»¥åŠ-dce-çš„å…³ç³»" class="header-anchor">#</a> Tree Shaking ä»¥åŠ DCE çš„å…³ç³»</h2> <p><code>DCE</code>å…¨ç§°<code>dead code elimination</code> å³: æ¶ˆé™¤é‚£äº›<code>æ ¹æœ¬ä¸ä¼šè¢«ç”¨åˆ°çš„å˜é‡/å‡½æ•°</code>, <code>æ°¸è¿œä¸ä¼šæ‰§è¡Œåˆ°çš„è¯­å¥</code>, <code>çº¯å‡½æ•°çš„è°ƒç”¨ä¸”å…¶ç»“æœæ²¡æœ‰è¢«ä½¿ç”¨</code>...</p> <div class="language-javaScript line-numbers-mode"><div class="highlight-lines"><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br><div class="highlighted">Â </div><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><div class="highlighted">Â </div><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br></div><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">pureAdd</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">unusedFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">pureAdd</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> unusedVar <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pureAdd</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token function">pureAdd</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">pureAdd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useunusedFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">unusedFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>ä¸Šé¢ ğŸŒ° ä¸­ é«˜äº®çš„éƒ¨åˆ†éƒ½å±äº<code>dead code</code>, éœ€è¦è¢«æ¸…é™¤</p> <hr> <p>æƒ³ä¸€ä¸‹ç›®å‰æˆ‘ä»¬æ˜¯å¦‚ä½•å¤„ç†è¿™äº›<code>dead code</code>çš„å‘¢?</p> <p>Answer:</p> <ul><li><strong>å¯¹é¡¹ç›®ç®¡ç†è€Œè¨€å€ŸåŠ©äº<code>git hooks</code>å’Œ<code>eslint</code></strong></li></ul> <p>æˆ‘ä»¬çŸ¥é“<code>elint</code>æ˜¯ä¸€ç§æ£€æŸ¥ä»£ç æ ¼å¼çš„å·¥å…·, åœ¨<code>pre-commit</code>å†…æ‰§è¡Œ<code>eslint</code>æ£€æŸ¥, å¯ä»¥é˜²æ­¢å¼€å‘è€…å°†ä¸ç¬¦åˆå·¥ç¨‹è§„èŒƒçš„ä»£ç ä¸Šä¼ </p> <ul><li><strong>å¯¹å¼€å‘è€…è€Œè¨€å€ŸåŠ©äº<code>eslint</code>, <code>ESLint(vscode æ’ä»¶), vscode</code>(å¦‚æœä½ ä½¿ç”¨ vscode ä½œä¸º IDE)</strong></li></ul> <p>å¯¹äºä½¿ç”¨<code>vscode</code>çš„å¼€å‘è€…, åªè¦é¡¹ç›®ä¸­å®‰è£…äº†<code>eslint(node package)</code>ä¾èµ–, åŒæ—¶<code>vscode</code>å®‰è£…äº†<code>ESLint(vscode æ’ä»¶)</code></p> <p>å°±å¯ä»¥ä¸€è¾¹ code, ä¸€è¾¹ä»£ç æ£€æŸ¥</p> <p>ç»™<code>vscode</code>å¢åŠ å¦‚ä¸‹é…ç½®, è¿˜èƒ½åœ¨ä¿å­˜çš„æ—¶å€™è‡ªåŠ¨ä¿®å¤ä¸€äº›å¯ä»¥ä¿®å¤çš„æ ¼å¼é—®é¢˜</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// setting.json</span>
<span class="token string">&quot;editor.codeActionsOnSave&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;source.fixAll.eslint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="eslint-eslint-pacakge-å’Œ-eslint-vscode-æ’ä»¶-åœ¨-dce-æ–¹é¢çš„å±€é™"><a href="#eslint-eslint-pacakge-å’Œ-eslint-vscode-æ’ä»¶-åœ¨-dce-æ–¹é¢çš„å±€é™" class="header-anchor">#</a> ESLint(eslint pacakge å’Œ ESLint vscode æ’ä»¶)åœ¨ DCE æ–¹é¢çš„å±€é™</h3> <p><code>eslint</code>: node package</p> <p><code>ESLint</code>: vscode plugin</p> <hr> <ul><li><strong>ä¸èƒ½ä¿å­˜æ—¶è‡ªåŠ¨ fix</strong></li></ul> <p>æˆ‘ä»¬çŸ¥é“<code>ESLint</code>æ˜¯åœ¨<strong>å¼€å‘æ—¶</strong>è¿›è¡Œä»£ç æ£€æµ‹, è€Œä¸æ˜¯åœ¨å¼€å‘å®Œæˆå, å¯¹äºä¸€äº›åƒ<code>unused</code>è¿™æ ·çš„é”™è¯¯, å¹¶ä¸ä¼šè‡ªåŠ¨ä¿®å¤(<strong>å› ä¸ºä¸çŸ¥é“è¿™ç±»é”™è¯¯æ˜¯å•çº¯æ²¡ç”¨åˆ°, è¿˜æ˜¯å¼€å‘è€…å¿˜è®°ç”¨äº†</strong>)</p> <p>æ‰€ä»¥å…¶åªèƒ½è®¾ç½®ä¿å­˜æ—¶ä¿®å¤ä»£ç æ ¼å¼, è€Œä¸èƒ½ä¿®å¤<code>dead code</code>å’Œå…¶ä»–ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç (<code>é‡å¤å˜é‡å</code>, <code>not in camel case</code>...)</p> <hr> <ul><li><p><strong>eslint å¯¹äº<code>dead code</code>çš„æ£€æµ‹æ¯”è¾ƒå±€é™</strong></p> <ul><li><p><strong>æ²¡æœ‰ä½¿ç”¨åˆ°è¿”å›å€¼çš„çº¯å‡½æ•°</strong></p> <p>çœ‹ä¸Šé¢ ğŸŒ° ä¸­<code>line 24</code>çš„ä»£ç <code>pureAdd(3, 4)</code>, <code>eslint</code>å¹¶ä¸ä¼šæ£€æµ‹å‡ºå®ƒæ˜¯ä¸€ä¸ªéœ€è¦å¤„ç†çš„å¼‚å¸¸, å› ä¸º<code>eslint</code>ä¸ä¼šåˆ†æå‡½æ•°<code>pureAdd(3, 4)</code>æ˜¯ä¸æ˜¯æœ‰æ„ä¹‰, å¯¹äºæ²¡æœ‰å‰¯ä½œç”¨çš„çº¯å‡½æ•°è€Œè¨€, å¦‚æœæ²¡ç”¨ç”¨åˆ°å‡½æ•°çš„è¿”å›å€¼, é‚£ä¹ˆå…¶å°±æ˜¯æ²¡æœ‰æ„ä¹‰çš„åŒæ ·å±äºæ˜¯ä¸€ç§<code>dead code</code></p></li> <li><p><strong>åªå¯¹å½“å‰æ–‡ä»¶ä½œç”¨åŸŸè¿›è¡Œæ£€æµ‹</strong> (è¿™ä¸ªæ€»ç»“ä¸å¦¥, ä½†æ˜¯æš‚æ—¶æ²¡æƒ³å¥½ TODO)</p> <p>å¦ä¸€æ–¹é¢<code>eslint</code>åªä¼šåœ¨å½“å‰æ–‡ä»¶ä½œç”¨åŸŸä¸‹è¿›è¡Œæ£€æµ‹, umm... è¿™ä¹ˆè¯´å¯èƒ½ä¸å¥½ç†è§£, è¿™é‡Œä¸¾ä¸ªå®é™…å¼€å‘ä¸­ä¸€å®šä¼šé‡åˆ°çš„ä¾‹å­</p> <p>ä½ å®Œæˆäº†ä¸€ä¸ªéœ€æ±‚, å‘ç°æœ‰ä¸€äº›<code>eslint</code>æ£€æµ‹å‡ºçš„å¼‚å¸¸, ä½†æ˜¯ä¼´éšè¿™ä½ å¯¹è¿™äº›å¼‚å¸¸çš„ä¿®å¤, ä¼šæœ‰æ›´å¤šçš„å¼‚å¸¸å‡ºç°...</p> <p>è¿™å°±æ˜¯æˆ‘è¯´çš„<strong>åªå¯¹å½“å‰æ–‡ä»¶ä½œç”¨åŸŸè¿›è¡Œæ£€æµ‹</strong>(ä¸‹é¢æ˜¯ç”¨ä¾‹å­å¯¹å…¶è§£é‡Š)</p> <p>å¯ä»¥çœ‹ä¸Šé¢ ğŸŒ° ä¸­<code>line 5 - 7</code> <code>line 27 - 29</code>, å‡½æ•°<code>unusedFunc</code>åªåœ¨<code>useunusedFunc</code>å†…è¢«è°ƒç”¨, è€Œå‡½æ•°<code>useunusedFunc</code>æ˜¯ä¸€ä¸ª<strong>æœªè¢«ä½¿ç”¨çš„å‡½æ•°</strong>, æ‰€ä»¥<code>unusedFunc</code>å’Œ<code>useunusedFunc</code>éƒ½æ˜¯<code>dead code</code></p> <p>ä½†æ˜¯<code>eslint</code>å´ä¸èƒ½å°†ä»–ä»¬ä¸€èµ·æ£€æµ‹å‡ºæ¥, åªèƒ½å…ˆæ£€æµ‹<code>useunusedFunc</code>, åœ¨<code>fix useunusedFunc</code>åæ‰èƒ½æ£€æµ‹å‡º<code>unusedFunc</code></p></li></ul></li></ul> <p>è¿™é‡Œæˆ‘æå‡ºçš„ 2 ç‚¹éƒ½æ˜¯<code>eslint</code>æ²¡æœ‰å®ç°, ä½†æ˜¯<code>rollup</code>å´å®ç°äº†çš„</p> <p>å½“ç„¶è¿˜æœ‰ä¸€äº›æƒ…å†µæ˜¯<code>rollup</code>å’Œ<code>eslint</code>éƒ½åšä¸åˆ°çš„<code>DCE</code>, æ¯”å¦‚</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
object<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// ä½†æ˜¯å´æ²¡æœ‰ä½¿ç”¨åˆ°object.açš„åœ°æ–¹</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>éš¾åšåˆ°çš„åŸå› åœ¨äº, javaScript æ˜¯åŠ¨æ€çš„è„šæœ¬è¯­è¨€, å¼•ç”¨å€¼å…·å¤‡ä»€ä¹ˆå±æ€§åªæœ‰åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰èƒ½è¢«ç¡®å®š, å¦‚æœä½ æƒ³å¯¹è¿™æ ·çš„å†…å®¹ä¹Ÿè¿›è¡Œæ£€æµ‹, æ¬¢è¿è¿ç§»<code>TypeScript</code></p> <hr> <p>è¯´äº†é‚£ä¹ˆå¤š, æœ‰ç‚¹è·‘é¢˜... æƒ³è®©ä½ çŸ¥é“çš„ä»…ä»…æ˜¯æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­, å·²ç»ä½¿ç”¨<code>eslint</code>å®Œæˆäº†å¤§éƒ¨åˆ†çš„<code>DCE</code>, ä¸‹é¢å°±ä»‹ç»ä»€ä¹ˆæ˜¯æˆ‘ç†è§£çš„<code>Tree Shaking</code></p> <h3 id="ä»€ä¹ˆæ˜¯-tree-shaking"><a href="#ä»€ä¹ˆæ˜¯-tree-shaking" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯ Tree Shaking</h3> <p><code>Tree Shaking</code>æœ¬è´¨ä¸Šæ¥è¯´è¿˜æ˜¯<code>DCE</code>, ä½†æ˜¯<code>DCE</code>æ˜¯å¯¹å•ä¸€æ–‡ä»¶åšä»£ç åˆ é™¤, è€Œ<code>Tree Shaking</code>æ˜¯ä¸åŒæ–‡ä»¶é—´çš„<code>DCE</code></p> <p>æ¢å¥è¯æ¥è¯´å¯¹äº<code>file A</code>, å¦‚æœåªåˆ†æ<code>file A</code>å†…çš„ä»£ç å°±æ˜¯<code>DCE</code></p> <p>å¦‚æœåœ¨åˆ†æ<code>file A</code>æ—¶, é™¤äº†è¦ä¾é å…¶æœ¬èº«çš„ä»£ç å¤–, è¿˜éœ€è¦<code>file B</code>å¯¹<code>file A</code>çš„ä¾èµ–ä¿¡æ¯, è¿™å°±æ˜¯<code>Tree Shaking</code></p> <p>çœ‹è¿™ä¸ª ğŸŒ°</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// math.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">except</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å¦‚æœåªä½¿ç”¨<code>eslint</code>æ£€æµ‹æ–‡ä»¶çš„è¯, ä¼šå‘ç°æ˜¯æ²¡æœ‰<code>dead code</code>çš„, å› ä¸º<code>export</code>å°±æ˜¯å¯¹<code>const *</code>çš„ä¸€æ¬¡ä½¿ç”¨</p> <p>æƒ³ä¸€ä¸‹å¦‚æœæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨<code>add</code>æ–¹æ³•å‘¢, å…¶ä»–æ–¹æ³•ä¹Ÿä¼šè¢«å¼•å…¥, åªå‡­å€Ÿä¼ ç»Ÿçš„<code>DCE</code>æ˜¯æ— æ³•å¤„ç†è¿™ç§æƒ…å†µçš„</p> <p><code>rollup</code>é’ˆå¯¹è¿™ç§<code>case</code>åšäº†ç‰¹æ®Šçš„é€»è¾‘, èƒ½å‡å°‘ä¸€ä¸ªæ¨¡å—ä¸­ä»æœªè¢«å…¶ä»–æ¨¡å—ä½¿ç”¨çš„ä»£ç </p> <p><strong><code>rollup</code>æŠŠä¼ ç»Ÿ<code>DCE</code>å’Œ<code>å‡å°‘å…¬å…±æ–‡ä»¶æœªå¼•å…¥éƒ¨åˆ†</code>åˆèµ·æ¥ç§°ä½œ<code>Tree Shaking</code></strong></p> <h2 id="webpack-æ˜¯å¦‚ä½•-tree-shaking"><a href="#webpack-æ˜¯å¦‚ä½•-tree-shaking" class="header-anchor">#</a> Webpack æ˜¯å¦‚ä½• Tree Shaking</h2> <p>åœ¨ webpack4 ä¹‹å‰, <strong>å¯ä»¥è¯´ webpack æ˜¯ä¸å…·å¤‡ Tree Shaking åŠŸèƒ½çš„</strong>, æœ‰çš„åªæ˜¯<strong>å€ŸåŠ©äº<code>uglifyjs</code>çš„<code>DCE</code></strong></p> <p>è¿™æ˜¯å› ä¸º<code>webpack</code>åªæ˜¯ä¸€ä¸ªç®€ç®€å•å•çš„æ¨¡å—åŒ–æ‰“åŒ…å·¥å…·å’Œæ ¸å¿ƒé€»è¾‘åœ¨äºå¤„ç†<code>import</code>å’Œ<code>export</code>å…³é”®å­—, æä¾›æ¨¡å—åŒ–å¤„ç†(å½“ç„¶ä¹Ÿæ­£æ˜¯å› ä¸ºå…¶ç›®çš„ç®€å•, æ‰€ä»¥æ‰èƒ½é›†æˆä¼—å¤š<code>loader</code>ä»¥åŠ<code>plugin</code>, æä¾›ä¸°å¯Œçš„é¢å¤–åŠŸèƒ½)</p> <p>å…¶ç¼ºå°‘å¯¹æ–‡ä»¶æœ¬èº«çš„åˆ†æ, åªæ˜¯å°†æ‰€æœ‰ js æ–‡ä»¶ç»è¿‡æ’ä»¶å¤„ç†å(<code>å¯èƒ½åŒ…å«babel</code>)æ‰“åŒ…åˆ°ä¸€ä¸ª<strong>bundle</strong>å†…(è¿™é‡Œä¸è€ƒè™‘æ‡’åŠ è½½çš„æƒ…å†µ)</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">/* moduleA */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack__require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> moduleB <span class="token operator">=</span> <span class="token function">__webpack__require</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* moduleB */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack__require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* moduleC */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack__require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* moduleD */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack__require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>å°†è¿™ä¸ªæ–‡ä»¶è¾“å…¥ç»™<code>uglifyjs</code>, ç”±<code>uglifyjs</code>å¯¹å…¶è¿›è¡Œ<code>DCE</code></p> <h3 id="webpack4-ä¹‹å‰ä»¤äººå°´å°¬çš„-tree-shaking"><a href="#webpack4-ä¹‹å‰ä»¤äººå°´å°¬çš„-tree-shaking" class="header-anchor">#</a> Webpack4 ä¹‹å‰ä»¤äººå°´å°¬çš„ Tree Shaking</h3> <p><code>uglifyjs</code>å¯¹äºä¸Šé¢<strong>bundle</strong>çš„<code>DCE</code>å…¶å®å°±æ˜¯åˆ†åˆ«å¯¹<code>moduleA</code>, <code>moduleB</code>, <code>moduleC</code>, <code>moduleD</code>åš<code>DCE</code></p> <p><strong>å¦‚æœä½ é¡¹ç›®ä½¿ç”¨äº†<code>eslint</code>, åœ¨å¼€å‘çš„æ—¶å€™å°±å·²ç»å¯¹å„ä¸ªæ¨¡å—åšäº†<code>DCE</code>(è™½ç„¶æ˜¯æ‰‹åŠ¨çš„), å¯ä»¥è¯´<code>uglifyjs</code>æ²¡åšä»€ä¹ˆå’Œ<code>DCE</code>æœ‰å…³çš„äº‹æƒ…</strong></p> <div class="custom-block warning"><p class="custom-block-title">ğŸ˜‚</p> <p>ç»ç”±<code>eslint</code>æ‰‹åŠ¨<code>DCE</code> å’Œ <code>uglifyjs</code>è‡ªåŠ¨<code>DCE</code> å¾—åˆ°çš„ä»£ç å·®ä¸å¤š</p> <p>å› ä¸º<code>uglifyjs</code>ä¸å…·å¤‡æµç¨‹åˆ†æ, é‡‡ç”¨äº†ä¸€ç§ç›¸å½“ä¿å®ˆçš„ç­–ç•¥</p> <p>ç”šè‡³äºæœ‰çš„æ—¶å€™<code>uglifyjs</code>è¿˜ä¼šæ¯”<code>eslint</code>çš„<code>DCE</code>æ•ˆæœè¿˜æŸ¥</p> <p>è¿™ç§æƒ…å†µå¤§å¤šå‘ç”Ÿåœ¨<code>babel</code>ç¼–è¯‘ä¸Š</p></div> <p>ç”±äº<code>babel</code>éœ€è¦ç¼–è¯‘å‡ºçš„ä»£ç éœ€è¦ç¬¦åˆ<code>API</code>, è¿˜è¦è€ƒè™‘æµè§ˆå™¨å…¼å®¹æ€§, ç¼–è¯‘å‡ºçš„ä»£ç å¯èƒ½ä¼šå¾ˆå¥‡æ€ª</p> <p>æ¯”å¦‚ç±»å°±ä¼šè¢«ç¼–è¯‘æˆç«‹å³æ‰§è¡Œå‡½æ•°çš„å½¢å¼</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// icon.js</span>

<span class="token keyword">class</span> <span class="token class-name">WarningIcon</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">DangerIcon</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Layzer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DangerIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>è¿™æ˜¯å¦‚æˆ‘ä»¬åˆ©ç”¨<code>eslint</code> èƒ½å¤Ÿæ£€æµ‹å‡º<code>WarningIcon</code>æ²¡æœ‰è¢«ä½¿ç”¨, æ‰‹åŠ¨åˆ é™¤</p> <p>ä½†æ˜¯å¦‚æœç»è¿‡<code>babel</code>ç¼–è¯‘ç”±<code>webpack</code>è¾“å…¥åˆ°<code>uglifyjs</code>å…¶å°±ä¼šæ˜¯ä¸‹é¢çš„ç»“æœ</p> <div class="language-javaScript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">(</span>
  <span class="token comment">// icon</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack__require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> WarningIcon <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å‡½æ•°æ‰§è¡Œå¯èƒ½ä¼šæœ‰å‰¯ä½œç”¨, è™½ç„¶æ²¡ç”¨åˆ°ä½†æ˜¯ä¸èƒ½åˆ é™¤</span>
      <span class="token comment">// ... ä¸€äº›babelç¼–è¯‘å‡ºçš„çƒ‚ä¸ƒå…«ç³Ÿçš„ä»£ç , éƒ½å¯èƒ½æœ‰å‰¯ä½œç”¨, æ›´åŠ ä¸èƒ½åˆ é™¤</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">const</span> DangerIcon <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Layzer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DangerIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// è¿™é‡Œä¹Ÿä¼šæœ‰å‰¯ä½œç”¨, ä¹Ÿæ˜¯å¯¼è‡´WarningIconä¸èƒ½åˆ é™¤çš„åŸå› </span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'WarningIcon'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> WarningIcon <span class="token punctuation">}</span><span class="token punctuation">)</span>

    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'DangerIcon'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> DangerIcon <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>çœ‹!! è¿™ä¸ªæ²¡ç”¨åˆ°çš„<code>WarningIcon</code>æ ¹æœ¬æ²¡è¢«ç”¨åˆ°, æˆ‘ä»¬çŸ¥é“å¯ä»¥åˆ é™¤, <code>uglifyjs</code>é‡‡ç”¨çš„ç­–ç•¥ä¸è®¤ä¸ºå…¶èƒ½è¢«åˆ é™¤, è¿™æ—¶å°±æ²¡æœ‰<code>eslint</code>çµæ´»</p> <p>æ‰€ä»¥åœ¨<strong>webpack4</strong>ä¹‹å‰æ ¹æœ¬æ²¡æœ‰<strong>Tree Shaking</strong>, åªæœ‰<strong>DCE</strong>, ä½†æ˜¯è¿™ä¸ª<strong>DCE</strong>ä¹Ÿåœ¨å¼€å‘è¿‡ç¨‹ä¸­åšå®Œäº†, æƒ³æˆ‘åœ¨<strong>webpack2</strong>çš„æ—¶å€™å°±å¬è¯´è¿‡<strong>webpack Tree Shaking</strong>, å½“æ—¶ä»¥ä¸ºæ˜¯ä¸€ä¸ªå¤š ğŸ‚ğŸº çš„ä¸œè¥¿ ç°åœ¨æƒ³æ¥ç€å®å°´å°¬ ğŸ˜…</p> <h3 id="rollup-å’Œ-uglifyjs-çš„ä¸åŒ-dce-ç­–ç•¥"><a href="#rollup-å’Œ-uglifyjs-çš„ä¸åŒ-dce-ç­–ç•¥" class="header-anchor">#</a> rollup å’Œ uglifyjs çš„ä¸åŒ DCE ç­–ç•¥</h3> <p><strong><code>uglifyjs</code>é‡‡ç”¨ä¿å®ˆç­–ç•¥å¯¹äºä¸€äº›å¯èƒ½å½±å“ç¨‹åºè¿è¡Œçš„ç»“æœéƒ½ä¿ç•™, å³ä½¿ä»–ä»¬æœªè¢«ä½¿ç”¨åˆ°</strong></p> <p><strong><code>rollup</code>å…·æœ‰ç¨‹åºæµåˆ†æ, å¯ä»¥å¾ˆå¥½çš„åˆ¤æ–­å‡ºå‡½æ•°... æ˜¯å¦å…·æœ‰èƒ½å½±å“ç¨‹åºè¿è¡Œçš„å‰¯ä½œç”¨</strong></p> <p>è¿˜è®°å¾—æœ€ä¸Šé¢çš„ä»£ç å˜›? æˆ‘å°†ä¸Šé¢çš„ä»£ç åˆ†åˆ«ç”¨<code>webpack uglifyjs</code>å’Œ<code>rollup</code>æ‰“åŒ…, ä»¥åŠå€ŸåŠ©<code>eslint</code>æ‰‹åŠ¨fixå¾—åˆ°å¦‚ä¸‹ç»“æœ</p> <ul><li><strong>rollup</strong></li></ul> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>webpack(uglifyjs)</strong></li></ul> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">pureAdd</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">pureAdd</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pureAdd</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>å¯ä»¥çœ‹åˆ°<code>pureAdd</code>å‡½æ•°ä»¥åŠç›¸åº”çš„æ‰§è¡Œè¢«<strong>uglifyjs</strong>ä¿ç•™äº†ä¸‹æ¥</p> <p>å› ä¸º<code>uglifyjs</code>ä¸èƒ½åˆ¤æ–­<code>pureAdd</code>æ˜¯å¦å…·æœ‰å‰¯ä½œç”¨æ‰€ä»¥å°†å…¶ä¿ç•™</p> <ul><li><strong>å€ŸåŠ©eslintæç¤ºæ‰‹åŠ¨DCE</strong></li></ul> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">pureAdd</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token function">pureAdd</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">pureAdd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å¯èƒ½è¢«ä¿ç•™pureAdd(a, b) */</span> <span class="token comment">/* ä¹Ÿå¯èƒ½åˆ é™¤ */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><hr> <h4 id="ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨"><a href="#ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨</h4> <p>å¦‚æœä½ ç”¨è¿‡<code>redux</code>æˆ–è€…<code>redux-saga</code>, ç›¸ä¿¡ä½ èƒ½æ˜ç¡®çŸ¥é“ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨.</p> <p>å‰¯ä½œç”¨å°±æ˜¯åœ¨é¢„æœŸå¤–çš„å½±å“å…¨å±€çš„ä¸€äº›è¯­å¥, ä¸‹é¢æˆ‘åªä¸¾å‡ ä¸ªä¾‹å­</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// example 1</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœæ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹, è¿™ä¼šåœ¨å…¨å±€å£°æ˜ä¸€ä¸ªå˜é‡b</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token comment">// example 2</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">definePrototype</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">setter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">getter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'getter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// è¿™ä¹Ÿæ˜¯å‰¯ä½œç”¨</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>å¯¹äºè¿™äº›å‰¯ä½œç”¨, <code>uglifyjs</code>ä¼šå°†ä»–ä»¬ä¿ç•™</p> <p>å…³äº<code>uglifyjs</code>å¯¹å‰¯ä½œç”¨çš„çœ‹æ³•å¯ä»¥çœ‹ä¸€ä¸‹è¿™æ¡<a href="https://github.com/mishoo/UglifyJS/issues/1261" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>å¤§æ¦‚å°±æ˜¯è¯´</p> <ol><li><code>uglifyjs</code>æ²¡æœ‰ç¨‹åºæµåˆ†æ, é‡‡ç”¨ä¿å®ˆç­–ç•¥ä¿ç•™ä»»ä½•å¯èƒ½æœ‰å‰¯ä½œç”¨çš„æ“ä½œ(å‡½æ•°æ‰§è¡Œ, å¼•ç”¨å±æ€§çš„èµ‹å€¼å’Œè¯»å–)</li> <li><code>rollup</code>åšäº†, å¯ä»¥è€ƒè™‘è¿ç§»</li> <li><strong>å¯ä»¥ç”¨<code>/*@__PURE__*/</code>è¡¨æ˜è¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œæ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„</strong></li></ol> <p>è¿˜æ˜¯æœ€ä¸Šé¢çš„ä¾‹å­, å¦‚æœæˆ‘ä»¬ç»™<code>line 24</code>å’Œ<code>line 25</code>åŠ ä¸Š<code>/*@__PURE__*/</code>å°±ä¼šå¾—åˆ°å¦‚ä¸‹çš„è¾“å‡º</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// uglifyjs</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="webpack4çš„tree-shaking"><a href="#webpack4çš„tree-shaking" class="header-anchor">#</a> Webpack4çš„Tree Shaking</h3> <p><strong>webpack4</strong>æœ¬è´¨ä¸Šè¿˜æ˜¯å€ŸåŠ©äº<code>uglifyjs</code>çš„<code>DCE</code>åŠŸèƒ½</p> <p>ä½†æ˜¯<strong>webpack4</strong>ä¸ºå…¶<strong>DCE</strong>æä¾›äº†é¢å¤–ä¿¡æ¯(æ˜¯å¦å¼•å…¥äº†æŸäº›æ–¹æ³•)</p> <p><strong>webpack4</strong>åœ¨è§£ææ¨¡å—æ—¶(<code>import</code>)èƒ½åå¾—åˆ°æ‰€æœ‰çš„ä¾èµ–ä¿¡æ¯, ç„¶åä¼šå°†ä»–ä»¬æ±‡æ€»å°†å’ŒæŸä¸ªæ¨¡å—æœ‰å…³çš„ä¿¡æ¯æ³¨å…¥åˆ°è¿™ä¸ªæ¨¡å—</p> <hr> <p>çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­ğŸŒ°</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// math.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">except</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>

<span class="token comment">// entry.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¢«ç¼–è¯‘ä¸ºå¦‚ä¸‹çš„<strong>bundle</strong>(ä¼ªç , è¾“å…¥åˆ°uglifyjså‰)</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">// entry.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// math.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">except</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>

    <span class="token comment">// __webpack_require.dæ˜¯ä¸€ä¸ªsetterå‡½æ•°, ä¼šè®²å‡½æ•°æŒ‚åœ¨åˆ°exports[moduleId]ä¸Š</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'reduce'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> reduce <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'multiply'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> multiply <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'except'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> except <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>å¯¹äºä¸Šé¢çš„<strong>bundle</strong>å¦‚æœ<strong>webpack</strong>èƒ½å¤Ÿåˆ é™¤<code>__webpack_require.d(exports, 'reduce|myltiply|except', function() { return reduce|multiply|except });</code>, åœ¨è¾“å…¥åˆ°<code>uglifyjs</code>ä¸­, <code>uglifyjs</code>å°±å¯ä»¥åˆ é™¤æ‰é™¤äº†<code>add</code>å¤–çš„å…¶ä»–å‡½æ•°</p> <hr> <h4 id="usedexports"><a href="#usedexports" class="header-anchor">#</a> usedExports</h4> <p><code>optimization.usedExports(boolean: false)</code> å°±åšäº†è¿™æ ·çš„äº‹æƒ…</p> <p>å¼€å¯äº†<strong>optimization.usedExports</strong>, <strong>webpack4</strong>ä¼šæ”¶é›†æ¨¡å—ç›¸äº’å¼•å…¥çš„ä¿¡æ¯, æœ€ç»ˆå°†ä¸è¯¥æ¨¡å—æœ‰å…³çš„ä¿¡æ¯æ±‡æ€», å‘ç°<code>math</code>æ¨¡å—çš„<code>reduce | multiply | except</code>æ–¹æ³•æ²¡æœ‰è¢«å¼•å…¥, åœ¨ç”Ÿæˆ<strong>bundle</strong>çš„æ—¶å€™å°±åªæ˜¯è¿™æ ·çš„</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// math.js</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">except</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>

  __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¿™æ ·ç»è¿‡<code>uglifyjs</code>å¤„ç†å°±åªå‰©ä¸‹äº†<code>add</code>å‡½æ•°</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>

  __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="webpack-deep-scope-analysis-plugin"><a href="#webpack-deep-scope-analysis-plugin" class="header-anchor">#</a> webpack-deep-scope-analysis-plugin</h4> <p><strong>webpack4</strong>çš„ä¾èµ–æ”¶é›†æœºåˆ¶æ˜¯å­˜åœ¨é—®é¢˜çš„, ä»–è®¤ä¸ºåªè¦è¢«<code>import</code>è¿‡è€Œä¸”åœ¨æ–‡ä»¶ä¸­åˆå‡ºç°è¿‡å°±ç®—æ˜¯è¢«ä¾èµ–</p> <p>è¿™æ˜¯é”™è¯¯çš„ ğŸ™…â€â™‚ï¸</p> <p>çœ‹ä¸€ä¸‹ä¸‹é¢çš„å…·ä½“ ğŸŒ°</p> <div class="language-javaScript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br></div><pre class="language-javascript"><code><span class="token comment">// math/add.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token comment">// math/reduce.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token comment">// math/multiply.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token comment">// math/except.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">except</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>

<span class="token comment">// math/index.js</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./add'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> reduce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./reduce'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> except <span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">'./except'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> multiply <span class="token keyword">as</span> multi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./multiply'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>argvs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">multi</span><span class="token punctuation">(</span><span class="token operator">...</span>argvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// entry.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å®é™…ç”¨åˆ°çš„æ–¹æ³•æ–¹æ³•åªæœ‰<code>add</code>, å…¶ä»–éƒ½åº”è¯¥è¢«åˆ é™¤</p> <p>è™½ç„¶æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬æ²¡æœ‰å¼•å…¥<code>multiply</code>, ä¹Ÿå°±ä¸åº”è¯¥æ‰“åŒ…<code>multi</code>, ä½†æ˜¯ç”±äº<strong>webpack</strong>ç¼ºå°‘ç¨‹åºæµåˆ†æ, ä»–åªæ˜¯ç®€å•çš„è®¤ä¸ºåªè¦<code>multi</code>åœ¨å½“å‰æ–‡ä»¶ä¸­å†æ¬¡å‡ºç°, å°±æ˜¯éœ€è¦è¢«å¼•å…¥äº†</p> <div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> reduce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./reduce'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> except <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./except'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> except <span class="token punctuation">}</span>

<span class="token comment">// ä¸Šé¢è¿™æ ·çš„éƒ½ä¸ç®—åœ¨æ–‡ä»¶ä¸­å†æ¬¡å‡ºç°, å› ä¸ºå®ƒä»¬éƒ½åªèµ·åˆ°äº†é€ä¼ çš„ä½œç”¨</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <p>ä¸‹é¢è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹, <strong>webpack</strong>å¯¹è¿™ç§æƒ…å†µæ‰“åŒ…åçš„<strong>bundle</strong>(å…³é—­äº†uglifyjs)</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è¿™é‡Œå°±åªå†™æ¨¡å—äº†</span>
<span class="token punctuation">[</span>
  <span class="token comment">// entry.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// math/index.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">const</span> <span class="token punctuation">{</span> multi <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>argvs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">multi</span><span class="token punctuation">(</span><span class="token operator">...</span>argvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// __webpack_require.d(exports, 'mulitply', function() { return mulitply });</span>
    <span class="token comment">// å› ä¸ºmultiplyæ²¡æœ‰è¢«ç”¨åˆ°, æ‰€ä»¥ä¸Šé¢æ²¡æœ‰ä¸Šé¢é‚£æ¡è¾“å‡ºçš„ä»£ç , æˆ‘å†™å‡ºå¹¶æ³¨é‡Šåªæ˜¯ä¸ºäº†è§£é‡Š</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// add</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// reduce</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>

    <span class="token comment">// æ²¡è¢«å¼•ç”¨</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// multi</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
  
    <span class="token comment">// è¢«math/indexæ¨¡å—çš„multiplyå‡½æ•°å¼•ç”¨äº†, æ‰€ä»¥è¢«ä¿ç•™, å³ä½¿: multiplyæ²¡æœ‰è¢«å¼•ç”¨</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'mulitply'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> muliply <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// except</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">except</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>

    <span class="token comment">// æ²¡è¢«å¼•ç”¨</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p><strong>webpack-deep-scope-analysis-plugin</strong>å°±å¯ä»¥è§£å†³éƒ¨åˆ†è¿™ç±»é—®é¢˜</p> <p><strong>webpack-deep-scope-anylysis-plugin</strong>é€šè¿‡ä»–æå‡ºçš„ä½œç”¨åŸŸåˆ†æ, èƒ½å¤Ÿå¾—åˆ°é‚£äº›æ–¹æ³•æ²¡æœ‰è¢«ä½¿ç”¨</p> <p>å…¶ä¾èµ–äº<strong>webpack</strong>çš„<strong>usedExports</strong>é€»è¾‘, åˆåé¦ˆç»™<strong>usedExports</strong></p> <p>æ€ä¹ˆç†è§£ä¸Šé¢çš„è¯, è¿˜éœ€è¦ç”¨ä¸Šé¢çš„ğŸŒ° æ¥è§£é‡Š</p> <ol><li><p><strong>webpack</strong>å‘Šè¯‰<strong>webpack-deep-scope-analysis-plugin</strong>, <code>entry.js</code> ç”¨åˆ°äº†<code>math/index.js</code>çš„<code>add</code>æ–¹æ³•</p></li> <li><p><strong>webpack-deep-scope-analysis-plugin</strong>åœ¨å¾—åˆ°ä¸Šè¿°ä¿¡æ¯çš„æƒ…å†µä¸‹, æ‰§è¡Œä»–çš„é€»è¾‘(åˆ†æä½œç”¨åŸŸ), å‘Šè¯‰<strong>webpack</strong>åœ¨<code>math/index.js</code>ä¸­å®é™…åªå¼•ç”¨äº†<code>./add.js</code>(<strong><code>multify</code>æ–¹æ³•å†…è°ƒç”¨çš„<code>multi</code>æ–¹æ³•ä¹Ÿæ²¡æœ‰è¢«å¼•ç”¨</strong>)</p> <p>ç›¸å½“äºå¯¹<code>math/index.js</code>è¿›è¡Œäº†2æ¬¡åˆ†æ</p></li> <li><p>æœ€ç»ˆ<strong>webpack</strong>å¾—åˆ°äº†è¿™äº›ä¿¡æ¯ç”Ÿæˆäº†è¿™æ ·çš„<strong>bundle</strong>(å…³é—­äº†uglifyjs)</p></li></ol> <div class="language-javaScript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br><br></div><pre class="language-javascript"><code><span class="token comment">// è¿™é‡Œå°±åªå†™æ¨¡å—äº†</span>
<span class="token punctuation">[</span>
  <span class="token comment">// entry.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// math/index.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">const</span> <span class="token punctuation">{</span> multi <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">function</span> <span class="token function">multify</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>argvs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">multi</span><span class="token punctuation">(</span><span class="token operator">...</span>argvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// add</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// reduce</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// multi</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
    <span class="token comment">// è¿™é‡Œæ²¡æœ‰äº†ä¹‹å‰çš„ __webpack_require.d(exports, 'mulitply', function() { return muliply });</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// except</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">except</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>å†ç»è¿‡<code>uglifyjs</code>å°±å¾—åˆ°äº†</p> <div class="language-javaScript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br></div><pre class="language-javascript"><code><span class="token comment">// è¿™é‡Œå°±åªå†™æ¨¡å—äº†</span>
<span class="token punctuation">[</span>
  <span class="token comment">// entry.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// math/index.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// add</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// reduce</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h5 id="æ¬¢è¿å›æ¥"><a href="#æ¬¢è¿å›æ¥" class="header-anchor">#</a> æ¬¢è¿å›æ¥</h5> <div class="custom-block warning"><p class="custom-block-title">- æ³¨æ„</p> <p>å¦‚æœä½ è¶³å¤Ÿç»†å¿ƒçš„è¯ï¼Œä½ ä¼šå‘ç°ä¸Šé¢ä»£ç ä¸­é«˜äº®çš„åœ°æ–¹éƒ½å¯ä»¥åˆ é™¤</p> <p>Really?</p> <p>å½“ç„¶ä¸èƒ½, å› ä¸ºè¿™å’Œæˆ‘ä»¬ä¸‹ä¸ªå°èŠ‚è¦è¯´çš„<code>sideEffects</code>ç›¸å…³</p></div> <div class="custom-block tip"><p class="custom-block-title">- æç¤º</p> <p>åŒæ ·çš„äº‹æƒ…ä¹Ÿä¼šå‘ç”Ÿåœ¨é‚£äº›åª<code>import</code>ä¸<code>export</code>çš„æ–‡ä»¶ä¸Š, æ¯”å¦‚ä¸Šé¢çš„<code>entry.js</code></p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// è¿™é‡Œç”±äºmainæ²¡æœ‰æ‰§è¡Œ, æ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›å¼•å…¥addæ–¹æ³•</span>

<span class="token comment">// è¿™ä¸ªåœ°æ–¹çš„å¤„ç†å°±ä¸èƒ½ä½¿ç”¨webpack-deep-scope-analysis-pluginäº†, å› ä¸ºè¿™ä¸ªpluginåªæœ‰æ¥å—åˆ°usedExportsçš„ç›¸å…³ä¿¡æ¯æ‰ä¼šæ‰§è¡Œ</span>

<span class="token comment">// è¿™é‡Œæ˜¯å…¥å£æ–‡ä»¶, æ²¡æœ‰åˆ«äººå¼•ç”¨, æ‰€ä»¥æ²¡æœ‰usedExportsä¿¡æ¯, pluginä¸ä¼šå·¥ä½œ</span>

<span class="token comment">// é‚£æˆ‘ä»¬æ€ä¹ˆå¤„ç†å‘¢? ? ?</span>

<span class="token comment">// å¾ˆç®€å•ç›´æ¥æ ¹æ®eslintæç¤ºä¿¡æ¯ åˆ é™¤mainæˆ–è€…æ‰§è¡Œmain</span>

<span class="token comment">// ä¸ºä»€ä¹ˆä¸Šé¢ä¼šä½¿ç”¨webpack-deep-scope-analysis-pluginå‘¢ï¼Ÿæ˜¯å› ä¸ºeslintåœ¨é‚£ç§æœ‰export çš„æ–‡ä»¶ä¸­æ— æ³•çŸ¥é“é‚£äº›è¢«æ²¡è¢«å¼•ç”¨ï¼Œåªèƒ½å€ŸåŠ©webpackçš„usedExportsåŠŸèƒ½</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div> <p><strong>åœ¨å‰é¢è¯´è¿‡<code>webpack-deep-scope-analysis-plugin</code>åªèƒ½è§£å†³éƒ¨åˆ†è¿™ç±»é—®é¢˜</strong> ä¸çŸ¥é“ä½ æ˜¯å¦å¿˜è®°æ²¡æœ‰</p> <p>è¿™æ˜¯å› ä¸º<code>webpack-deep-scope-analysis-plugin</code>æ˜¯åŸºäºå…¶ä½œç”¨åŸŸçš„é€»è¾‘æ‰¾åˆ°æœªä½¿ç”¨çš„æ–¹æ³•çš„, æ²¡æœ‰ç¨‹åºæµæ§åˆ¶, å¯¹äºä¸‹é¢ä¸€äº›æƒ…å†µä¸èƒ½æ­£å¸¸å·¥ä½œ</p> <ul><li><strong>èµ‹å€¼</strong></li></ul> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// math.js</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./add'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> reduce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./reduce'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> except <span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">'./except'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> multiply <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./multiply'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> multiplyAlias <span class="token operator">=</span> multiply  <span class="token comment">// è¿™ç§æƒ…å†µä¼šè®¤ä¸ºmultiplyæ–¹æ³•ä¹Ÿè¢«ä½¿ç”¨äº†, ä¼šè¢«æ‰“åŒ…</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>å‡½æ•°æ‰§è¡Œ</strong></li></ul> <div class="language-javaScript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br></div><pre class="language-javascript"><code><span class="token comment">// math.js</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./add'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> reduce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./reduce'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> except <span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">'./except'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> multiply <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./multiply'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> number <span class="token operator">=</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¿™ç§ç›´æ¥æ‰§è¡Œçš„å‡½æ•°æ— æ³•åˆ†ææƒ…å†µæ— æ³•åˆ†æ</span>
<span class="token comment">// ä¼šæ‰“åŒ…multiply</span>

<span class="token comment">// ä½†æ˜¯å¦‚æœä½ çš„å‡½æ•°æ˜¯ä¸€ä¸ªçº¯å‡½æ•°å¯ä»¥åƒuglifyjsä¸€æ ·åŠ /*@__PURE__*/æ³¨é‡Š</span>
<span class="token comment">// è¿™æ ·å°±ä¸ä¼šæ‰“åŒ…multiply</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> number <span class="token operator">=</span> <span class="token comment">/*@__PURE__*/</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// entry.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li><strong>æ ¹åŸŸä¸‹çš„å‡½æ•°æ‰§è¡Œ/æˆ–è¯­å¥</strong></li></ul> <p>è¿˜æ˜¯ä¸Šé¢çš„ğŸŒ°</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> number <span class="token operator">=</span> <span class="token comment">/*@__PURE__*/</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1. è¿™ç§ä¼šä¸æ‰“åŒ…multiply</span>

<span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2. è¿™ç§å°±ä¼šæ‰“åŒ…multiply</span>
<span class="token comment">/*@__PURE__*/</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.  è¿™ç§ä¹Ÿä¼šæ‰“åŒ…multiply</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4.  è¿™ç§å½“ç„¶æ›´ä¼šæ‰“åŒ…multiply</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>OMG ! ! è¿™é‡Œæˆ‘å°±ä¸å¤ªæ‡‚äº†(å¯¹äº<code>3</code>)</p> <p>æŒ‰ç…§æˆ‘çš„ç†è§£</p> <ol><li><p><code>1</code>å¯ä»¥è¿›è¡Œä½œç”¨åŸŸåˆ†æ</p></li> <li><p>é‚£ä¹ˆ<code>2</code>ä¹Ÿæ˜¯å¯ä»¥çš„, æ‰€ä»¥æˆ‘è®¤ä¸º<code>2</code>ä¼šæ‰“åŒ…<code>multiply</code>çš„åŸå› åœ¨äº<code>multiply(1, 2)</code>å¯èƒ½æ˜¯æœ‰å‰¯ä½œç”¨çš„</p></li> <li><p>æ‰€ä»¥æˆ‘å°è¯•äº†<code>3</code>, å‘ç°ä¹Ÿè¢«æ‰“åŒ…äº†(<strong>è¿™å°±è®©æˆ‘è´¹è§£äº†, åº”è¯¥æ˜¯å¿½ç•¥äº†è¿™ç§caseå§</strong>)</p></li> <li><p>è¿™ç§æ˜æ˜¾çš„å‰¯ä½œç”¨æ˜¾ç„¶åº”è¯¥æ‰“åŒ…<code>multiply</code></p></li></ol> <p>å¦‚æœä½ å¯¹<code>webpack-deep-scope-analysis-plugin</code>æ„Ÿå…´è¶£çš„è¯, ğŸ‘€ ğŸ‘‡</p> <p><a href="https://diverse.space/2018/05/better-tree-shaking-with-scope-analysis" target="_blank" rel="noopener noreferrer">webpack-deep-scope-analysis-plugin ä¸­æ–‡æ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <hr> <h4 id="sideeffects"><a href="#sideeffects" class="header-anchor">#</a> sideEffects</h4> <p>è¿˜è®°å¾—æˆ‘ä»¬å‰é¢è¿‡<a href="/weblog/engineering/tree_shaking.html#æ¬¢è¿å›æ¥">ç‚¹è¿™é‡Œ</a>, <strong>webpack4</strong>å¯¹äºæŸäº›ç©ºåŒ…ä¾ç„¶ä¿ç•™äº†</p> <div class="language-javaScript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br></div><pre class="language-javascript"><code><span class="token comment">// math/add.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token comment">// math/reduce.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token comment">// math/multiply.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token comment">// math/except.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">except</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>

<span class="token comment">// math/index.js</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./add'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> reduce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./reduce'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> except <span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">'./except'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> multiply <span class="token keyword">as</span> multi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./multiply'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>argvs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">multi</span><span class="token punctuation">(</span><span class="token operator">...</span>argvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// entry.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ‰“åŒ…å</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">...</span>
  <span class="token comment">// reduce</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™é‡Œ</span>
    <span class="token string">'use strict'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// except</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™é‡Œ</span>
    <span class="token string">'use strict'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>ä¸ºä»€ä¹ˆå‘¢?</p> <p>è¿™æ˜¯å› ä¸ºè™½ç„¶å¯¹äº<code>reduce.js</code>è€Œè¨€, é‡Œé¢åªæœ‰<code>export const reduce = (a, b) =&gt; a - b;</code>è¿™ä¸€è¡Œä»£ç ä¸”æˆ‘ä»¬æ²¡æœ‰å¼•å…¥<code>reduce</code>å‡½æ•°</p> <p>ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¼•å…¥äº†<code>reduce.js</code>æ–‡ä»¶çš„, å¦‚æœé‡Œé¢è¿˜æœ‰ä¸€äº›å…¶ä»–çš„å‡½æ•°å‘¢?</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™æ˜¯å‰¯ä½œç”¨</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>è¿™æ—¶å€™å°±è¦è®²å…¶æ”¾å…¥åˆ°<strong>bundle</strong>ä¸­çš„<strong>reduce</strong>æ¨¡å—é‡Œ</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token comment">// reduce</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™é‡Œ</span>
    <span class="token string">'use strict'</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å¦‚æœæˆ‘ä»¬æƒ³åˆ é™¤è¿™äº›ä»£ç , æ€ä¹ˆåŠå‘¢? åˆè¦ä½¿ç”¨<code>/*@__PURE__*/</code>(å› ä¸ºæœ€ç»ˆå…¶éƒ½æ˜¯é€šè¿‡uglifyjsè¿›è¡Œ<code>DCE</code>)</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*@__PURE__*/</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è™½ç„¶æœ‰å‰¯ä½œç”¨, ä½†æ˜¯æˆ‘å°±ä¸è®¤ä¸ºä»–æœ‰</span>
<span class="token comment">// è¿™æ ·æœ€ç»ˆå°±ä¸ä¼šæ‰“åŒ…è¿›å»äº†</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p>éœ€è¦æŒ‡å®š<code>uglifyjs</code>çš„<code>compress.side_effects: true</code></p> <p>å¦åˆ™ <code>/*@__PURE__*/</code> åªå¯¹ <code>const a = /*@__PURE__*/log()</code> èµ·ä½œç”¨</p> <p>å¯¹<code>/*@__PURE__*/log()</code> ä¸èµ·ä½œç”¨</p></div> <p>ä½ ä¼šå‘ç°ä¸Šé¢çš„ä¸œè¥¿å’Œæ ‡é¢˜<strong>sideEffects</strong>æ— å…³, åˆ«æ€¥ ä¸‹é¢å°±è¦è¿›å…¥æ­£ä½“äº†</p> <hr> <p>å‰é¢æåˆ°å¯¹äºğŸ”§åŒ…ä¸­çš„ åœ¨å¼•å…¥åŒ…çš„æ—¶å€™å°±æ‰§è¡Œçš„å‡½æ•°æˆ–è€…è¯­å¥èƒ½ä½¿ç”¨<strong>uglifyjs</strong>ç‰¹æ€§<code>/*@__PURE__*/</code>æ¥åˆ é™¤, ä½†æ˜¯åœ¨æœ€å‰é¢ä¹Ÿæè¿‡äº†</p> <p><code>uglifyjs</code>ä¸ä¼šåˆ é™¤å¯èƒ½æœ‰å‰¯ä½œç”¨çš„æ“ä½œ, <code>/*@__PURE__*/</code>åªèƒ½åº”ç”¨åœ¨å‡½æ•°ä¸Š</p> <p>çœ‹ä¸‹é¢çš„ğŸŒ°</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// math.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> multiply <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./multiply'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./add'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> reduce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./reduce'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> except <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./except'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  add<span class="token punctuation">,</span>
  reduce<span class="token punctuation">,</span>
  except<span class="token punctuation">,</span>
  multiply<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// entry.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>å°†<code>math.js</code>å˜æˆè¿™æ ·, å†è¿›è¡Œæ‰“åŒ…, ä½ ä¼šå‘ç°<code>reduce</code>, <code>except</code>, <code>multiply</code>éƒ½åœ¨<strong>bundle</strong>å†…</p> <p>æ›´å¯æ¶çš„æ˜¯ä½ æ‰¾ä¸åˆ°åŠæ³•æ¥åˆ é™¤ä»–ä»¬</p> <h5 id="çœŸçš„æ‰¾ä¸åˆ°æ–¹æ³•ä¹ˆ"><a href="#çœŸçš„æ‰¾ä¸åˆ°æ–¹æ³•ä¹ˆ" class="header-anchor">#</a> çœŸçš„æ‰¾ä¸åˆ°æ–¹æ³•ä¹ˆ?</h5> <ol><li><strong>uglifyjs</strong>è‚¯å®šä¸è¡Œäº†</li></ol> <p>å› ä¸º<code>export default { ... }</code>å°±æ˜¯</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>add <span class="token operator">=</span> add<span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>reduce <span class="token operator">=</span> reduce<span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å¤šä¹ˆæ˜æ˜¾çš„å‰¯ä½œç”¨æ“ä½œ</p> <ol start="2"><li><strong>webpack-deep-scope-analysis-plugin</strong></li></ol> <p>ä¹Ÿä¸è¡Œ...</p> <p>è·ŸåŸŸä¸‹çš„è¯­å¥...</p> <ol start="3"><li><strong>å£åèŠ¬èŠ³</strong></li></ol> <hr> <p>æ‰€ä»¥<strong>webpack4</strong>ä¸ºäº†<strong>fix</strong>è¿™ç§<strong>case</strong>, æä¾›äº†<code>optimization.sideEffects: true</code></p> <p>åŒæ—¶è¿˜è¦å°†<code>math.js</code>å˜æˆä¸€ä¸ª<code>npm package</code></p> <p>å¹¶ä¸”è¿˜è¦å¯¹å…¶<code>package.json</code>å¢åŠ <code>&quot;slideEffects&quot;: boolean | (glob file)[]</code></p> <ul><li><p><code>sideEffects: true</code></p> <p>æ•´ä¸ªé¡¹ç›®æœ‰å‰¯ä½œç”¨</p></li> <li><p><code>sideEffects: false</code></p> <p>æ•´ä¸ªé¡¹ç›®æ²¡æœ‰å‰¯ä½œç”¨</p></li> <li><p><code>sideEffects: (glob file)[]</code></p> <p>æ•´ä¸ªé¡¹ç›®åªæœ‰æ•°ç»„å†…çš„ç¬¦åˆ<code>glob</code>æ ¼å¼çš„æ–‡ä»¶æœ‰å‰¯ä½œç”¨, å…¶ä½™æ²¡æœ‰</p></li></ul> <p>æ‰€ä»¥</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'math'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// math</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./add'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> reduce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./reduce'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> multiply <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./multiply'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> except <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./except'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  add<span class="token punctuation">,</span>
  reduce<span class="token punctuation">,</span>
  except<span class="token punctuation">,</span>
  multiply<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å¦‚æœ<code>math package</code>çš„<code>package.json.slideEffects === false</code>, é‚£ä¹ˆ<strong>webpack</strong>åœ¨æœ€åè¾“å‡º<strong>bundle</strong>(æœªè¾“å…¥uglifyjs)æ—¶å°±ä¼šå°†é™¤äº†<code>import { add } from './add'</code>çš„å†…å®¹ä¸€åˆ€åˆ‡</p> <p>ä¸‹é¢æ˜¯2ä¸ª<strong>bundle</strong>çš„å¯¹æ¯”</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ä»æ¨¡å—å¼•å…¥å¼€å§‹</span>

<span class="token comment">// æœªé…ç½®slideEffects</span>
<span class="token punctuation">[</span>
  <span class="token comment">// entry</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// math/index.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> reduce <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> multiply <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> except <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'reduce'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> reduce <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'multiply'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> multiply <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'except'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> except <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// add</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// reduce</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'reduce'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> reduce <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// multiply</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'multiply'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> multiply <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// except</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">except</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'except'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> except <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">// é…ç½®äº†æ­£ç¡®çš„sideEffects</span>

<span class="token punctuation">[</span>
  <span class="token comment">// entry</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// math/index.js</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">__webpack_require</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// add</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    __webpack_require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><hr> <p>ç»¼ä¸Š, æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­å¯èƒ½è™½ç„¶åªå¼•å…¥äº†æŸä¸ªğŸ”§ libä¸­çš„å‡ ä¸ªæ–¹æ³•, ä½†æ˜¯æ‰“åŒ…çš„æ—¶å€™ä¼šå°†æ•´ä¸ªğŸ”§ lib éƒ½æ‰“å…¥<strong>bundle</strong></p> <p>å°±æ˜¯å› ä¸º<code>ğŸ”§ lib</code>ä¸­å­˜åœ¨ä¸€äº›å‰¯ä½œç”¨</p> <p>æ¯”å¦‚<code>lodash-es</code>, å¦‚æœä½ ğŸ‘€ ä»–çš„æºç çš„è¯, å°±ä¼šå‘ç°å…¶å°±æœ‰åƒæˆ‘ä»¬ä¸Šé¢æåˆ°çš„<code>export default { ... }</code>, ä¸€æ ·çš„å†™æ³•</p> <p>è¿™æ˜¯å…¶APIå†³å®šçš„<code>import { _ } from 'lodash_es'</code>, <code>import { isNull } from 'lodash-es'</code></p> <hr> <p>å…¶å®<a href="/weblog/engineering/tree_shaking.html#çœŸçš„æ‰¾ä¸åˆ°æ–¹æ³•ä¹ˆ">ä¸Šé¢</a>æåˆ°çš„é™¤äº†ä½¿ç”¨<code>sideEffects</code>æ‰¾ä¸åˆ°å…¶ä»–æ–¹æ³•åªæ˜¯ä¸ºäº†å¼•å‡º<code>slideEffects</code>å†…å®¹</p> <p>åœ¨è¿™é‡Œéœ€è¦è¡¥å……ä¸€ä¸‹å…¶ä»–æ–¹æ³•</p> <ol><li><strong>ç›´æ¥å¼•å…¥æ–‡ä»¶è·¯å¾„, ä¸éœ€è¦é€ä¼ </strong></li></ol> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>

<span class="token comment">// ä½¿ç”¨ä¸‹é¢çš„å†™æ³•</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math/add.js'</span><span class="token punctuation">;</span> <span class="token comment">// è¿™æ ·å°±è¶Šè¿‡äº†å¯¹math/index.jsçš„Tree Shakingå¤„ç†</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li><strong>å¼€å‘è„šæœ¬æˆ–babelæ’ä»¶</strong></li></ol> <p>å°†</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./add'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ç¼–è¯‘æˆ</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math/add.js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æœ¬è´¨æ˜¯ä¸€æ ·çš„</p> <p><code>Antd</code>å°±æ˜¯å¼€å‘çš„<code>babel plugin</code></p> <h2 id="ä¸€äº›å…¶ä»–æ³¨æ„ç‚¹"><a href="#ä¸€äº›å…¶ä»–æ³¨æ„ç‚¹" class="header-anchor">#</a> ä¸€äº›å…¶ä»–æ³¨æ„ç‚¹</h2> <h3 id="tree-shakingåªæœ‰ä½¿ç”¨es6æ¨¡å—åŒ–æ‰å¯ä»¥"><a href="#tree-shakingåªæœ‰ä½¿ç”¨es6æ¨¡å—åŒ–æ‰å¯ä»¥" class="header-anchor">#</a> Tree Shakingåªæœ‰ä½¿ç”¨ES6æ¨¡å—åŒ–æ‰å¯ä»¥</h3> <p><strong>ä¸ºä»€ä¹ˆ?</strong></p> <p>è€å®è¯´æˆ‘ä¸æ¸…æ¥š, è¿™ä¸ªä¸œè¥¿æ˜¯æ€ä¹ˆä¼ å‡ºæ¥çš„, å¥½åƒå¤§å®¶éƒ½åœ¨è¿™ä¹ˆè¯´... ğŸ˜¢ğŸ˜¢ğŸ˜¢</p> <p><strong>é™æ€åˆ†æ?</strong></p> <p>ä½†æ˜¯è¿™åªæ˜¯<code>ES6</code>å¯¹æµè§ˆå™¨<code>import/export</code>çš„è¦æ±‚, å®é™…<code>webpack</code>åªæ˜¯æä¾›äº†ä»–çš„<code>polyfill</code></p> <p>åº•å±‚ä¾æ—§æ˜¯åŠ¨æ€å¼•å…¥çš„</p> <p>å”¯ä¸€å¯èƒ½çš„æ˜¯åœ¨<code>webpack</code>åŠ¨æ€å¼•å…¥çš„æ—¶å€™ä¼šåˆ†ææ¨¡å—çš„ä¾èµ–å…³ç³»</p> <p>ä½†æ˜¯åŒæ ·çš„, è¿™å¯¹<code>commonJS(require)</code>ä¹Ÿåº”è¯¥æ˜¯å¯è¡Œçš„</p> <hr> <p><strong>æˆ‘èƒ½æƒ³åˆ°çš„å”¯ä¸€åŸå› åœ¨äº</strong></p> <p><code>import</code>åªèƒ½å‡ºç°åœ¨é¡¶å±‚, ä¸èƒ½å‡ºç°åœ¨å‡½æ•°æˆ–è€…æ¡ä»¶è¯­å¥ä¸­</p> <div class="language-javaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span> 

<span class="token comment">// ä½†æ˜¯å¯¹äºrequireåˆ™å¯ä»¥</span>
<span class="token comment">// ...</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./math'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// è¿™æ ·obj.flagæ˜¯åŠ¨æ€å†³å®šçš„</span>


<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./math'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// webpackä¸ä¼šå¯¹ç¨‹åºæµè¿›è¡Œåˆ†æ</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ä½†æ˜¯å¯ä»¥æ— è®ºæ€æ ·, åªè¦å‡ºç°äº†å°±å¼•å…¥å‘€...</p> <hr> <p>æ‰€ä»¥, ç›®å‰æˆ‘è®¤ä¸º<strong>Tree Shakingåªæœ‰ä½¿ç”¨ES6æ¨¡å—åŒ–æ‰èƒ½åšåˆ°</strong>æ˜¯é”™è¯¯çš„ğŸ™…â€â™‚ï¸, æ‰¾ä¸åˆ°å¿…ç„¶åŸå› è¯æ˜å…¶ä¸å¯è¡Œ, å•çº¯æ˜¯<code>webpack</code>å’Œ<code>rollup</code>æ²¡åšè€Œå·²</p> <h2 id="ä¸ºäº†æ›´å¥½çš„tree-shakingæˆ‘ä»¬åº”è¯¥æ³¨æ„é‚£äº›äº‹æƒ…"><a href="#ä¸ºäº†æ›´å¥½çš„tree-shakingæˆ‘ä»¬åº”è¯¥æ³¨æ„é‚£äº›äº‹æƒ…" class="header-anchor">#</a> ä¸ºäº†æ›´å¥½çš„Tree Shakingæˆ‘ä»¬åº”è¯¥æ³¨æ„é‚£äº›äº‹æƒ…</h2> <ol><li><p>å¦‚æœå¯èƒ½çš„è¯rollup &gt; webpack</p></li> <li><p>å¯¹ä¸€äº›æ²¡æœ‰å‰¯ä½œç”¨çš„å‡½æ•°æ‰§è¡Œæ·»åŠ <code>/*@__PURE__*/</code>æ³¨é‡Š</p></li> <li><p>å¦‚æœä½ ä½¿ç”¨çš„webpackç‰ˆæœ¬ä½äºv4.0.0, å¯ä»¥è®¤ä¸ºwebpackæ˜¯ä¸å…·å¤‡Tree ShakingåŠŸèƒ½çš„, åªèƒ½æŒ‰éœ€å¼•å…¥, æˆ–è€…åƒAntdé‚£æ ·å¼€å‘<code>babel-plugin</code>å¤„ç†<code>import { Icon } from 'antd'</code>è¿™ç§case</p></li> <li><p>å¦‚æœä½ çš„webpackç‰ˆæœ¬å¤§äºv4.0.0, å¯ä»¥ä½¿ç”¨<code>webpack-deep-scope-analysis-plugin</code>æ’ä»¶å¢å¼ºå…¶åˆ¤æ–­æŸæ–¹æ³•æ˜¯å¦è¢«å¼•å…¥çš„é€»è¾‘</p></li> <li><p>å¦‚æœä½ <code>import { isNull } from 'lodash'</code>, éœ€è¦æ³¨æ„é…ç½®sideEffects.</p></li> <li><p>å‰©ä¸‹çš„å°±éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æäº†, é€šè¿‡åˆ†æ<strong>bundle</strong>æ‰¾å‡ºåŸå› </p> <p>ä¸»è¦ä»<strong>webpackå¯¹äºæ–¹æ³•çš„ä¾èµ–åˆ¤æ–­æ˜¯å¦æ­£ç¡®</strong>, <strong>ä»£ç æ˜¯å¦äº§ç”Ÿå‰¯ä½œç”¨å¯¼è‡´uglifyjsæ— æ³•DCE</strong>2æ–¹é¢åˆ†æ</p></li></ol> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <ul><li><p><strong>ä»€ä¹ˆæ˜¯Tree Shaking ä»€ä¹ˆæ˜¯DCE</strong></p></li> <li><p><strong>uglifyjsä¸èƒ½å¯¹å¯èƒ½æœ‰å‰¯ä½œç”¨çš„ä»£ç è¿›è¡ŒDCE</strong></p></li> <li><p><strong>å¯ä»¥ä½¿ç”¨<code>/*@__PURE__*/</code>æ¥å‘Šè¯‰uglifyjsè¿™æ˜¯ä¸€ä¸ªçº¯å‡½æ•°æ‰§è¡Œ</strong></p></li> <li><p><strong>wepback4ä¹‹å‰ä¸å­˜åœ¨Tree Shaking æœ‰çš„åªæ˜¯uglifyjsçš„DCE</strong></p></li> <li><p><strong>webpack4 usedExportsæ˜¯å¦‚ä½•è¾…åŠ©uglifyjså®ŒæˆTree Shakingçš„, ä»¥åŠusedExportsçš„ç¼ºé™·</strong></p></li> <li><p><strong>webpack-deep-scope-analysis-pluginæ˜¯æ€ä¹ˆå¢å¼ºusedExportsé€»è¾‘çš„</strong></p></li> <li><p><strong>ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨sideEffects</strong></p></li> <li><p><strong>ä¸ºäº†æ›´å¥½çš„Tree Shakingæˆ‘ä»¬åº”è¯¥åšäº›ä»€ä¹ˆ</strong></p></li> <li><p><strong>å‡ºç°äº†ä¸æœŸæœ›çš„Tree Shakingæˆ‘ä»¬è¦ä»é‚£å†™æ–¹é¢æ’æŸ¥é—®é¢˜</strong></p></li></ul> <h2 id="refs"><a href="#refs" class="header-anchor">#</a> Refs</h2> <p><a href="https://diverse.space/2018/05/better-tree-shaking-with-scope-analysis" target="_blank" rel="noopener noreferrer">webpack-deep-scope-analysis-plugin ä¸­æ–‡æ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.im/post/6844903549290151949" target="_blank" rel="noopener noreferrer">ä½ çš„Tree-Shakingå¹¶æ²¡ä»€ä¹ˆåµç”¨<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/arkusa/askura/edit/master/docs/engineering/tree_shaking.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘æ­¤é¡µé¢</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/19/2020, 2:41:05 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/weblog/assets/js/app.73afb69f.js" defer></script><script src="/weblog/assets/js/2.b1d48028.js" defer></script><script src="/weblog/assets/js/16.889db329.js" defer></script>
  </body>
</html>
